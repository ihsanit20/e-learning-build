import{b as P,c as T,u as B,r as p,o as M,d as E,e as c,f as i,t as a,g as e,s as h,z as g,A as S,F as V,D as j,q as k,i as x,x as K}from"./index-CGxlq7hy.js";import{u as N}from"./purchase-DAzzshWz.js";import{u as R}from"./coupon-CdrTD0zS.js";const $="/assets/bkash_payment_logo-CHh0TPdw.png",A={class:"my-container py-4"},I={key:0,class:"error"},L={key:1,class:"space-y-4"},U={class:"grid md:grid-cols-2 gap-4"},q={class:"card-bg p-4 flex gap-4"},z=["src"],H={class:"space-y-2"},O={class:"title-xl"},G={class:"flex gap-4 justify-between"},J={class:"font-bold text-sky-600"},Q={key:0},W={class:"font-bold text-sky-600"},X={key:1,class:"bg-pink-50 px-3 rounded-full"},Y={class:"font-bold text-pink-600"},Z={class:"card-bg p-4 space-y-2"},ee={class:"space-y-1"},te={class:"flex justify-between"},se={class:"flex justify-between"},oe={class:"flex justify-between font-bold"},le={class:"flex gap-2"},ae={class:"mt-2"},ne={class:"flex items-center space-x-4"},ue={key:1,class:"mt-2 text-red-600 font-bold text-center text-xl"},re={key:2},ve={__name:"CheckOut",setup(ce){const b=P(),_=T(),n=B(),y=N(),C=R(),f=b.params.id,o=p(null),u=p(null),v=p("bkash_payment"),m=p(""),r=p(null);M(async()=>{var s;try{if(await n.fetchCourse(f),o.value=n.course,(s=n==null?void 0:n.course)!=null&&s.is_purchased)return _.replace(`/my/course/${n==null?void 0:n.course.id}`)}catch(t){u.value=t.message||"Failed to fetch course"}});const d=E(()=>{if(!o.value)return 0;let s=0;return r.value&&(r.value.discount_type==="percentage"?s=o.value.price*r.value.discount_value/100:s=r.value.discount_value),s}),w=async()=>{try{const s=await C.fetchCouponByCode(m.value);if(console.log(s),!s)throw new Error("Invalid coupon code");r.value=s,u.value=null,console.log("Coupon applied:",r.value)}catch(s){u.value=s.message||"Invalid coupon code",console.error("Error applying coupon:",u.value),r.value=null}},D=async()=>{var s,t;try{if(v.value==="bkash_payment"){const l=await y.createPayment(f,{coupon_code:(s=r.value)==null?void 0:s.code});console.log("Bkash payment response:",l),window.location=(t=l==null?void 0:l.data)==null?void 0:t.bkashURL}else v.value==="bank_transfer"&&(alert("Bank Transfer selected. Checkout completed successfully!"),_.push("/my/course"))}catch(l){u.value=l.message||"Failed to initiate payment",console.error("Error during checkout:",u.value)}},F=s=>K(new Date(s),"dd-MMM-yyyy");return(s,t)=>(c(),i("div",A,[u.value?(c(),i("div",I,a(u.value),1)):o.value?(c(),i("div",L,[t[12]||(t[12]=e("h1",{class:"title-xl text-center"},"Checkout Page",-1)),e("div",U,[e("div",q,[e("div",null,[e("img",{src:o.value.thumbnail,alt:""},null,8,z)]),e("div",H,[e("h1",O,a(o.value.title),1),e("div",G,[e("p",null,[t[2]||(t[2]=h(" Course Fee: ")),e("span",J,a(o.value.price>0?`${o.value.price} TK`:"Free"),1)]),o.value.course_type==="Live Course"?(c(),i("p",Q,[t[3]||(t[3]=h(" Start Date: ")),e("span",W,a(F(o.value.start_date)),1)])):(c(),i("p",X,[e("span",Y,a(o.value.course_type),1)]))])])]),e("div",Z,[t[10]||(t[10]=e("h4",{class:"title-lg text-center"},"Payment Details",-1)),e("div",ee,[e("div",te,[t[4]||(t[4]=e("p",null,"Course Fee",-1)),e("p",null,a(o.value.price>0?`${o.value.price} TK`:"Free"),1)]),e("div",se,[t[5]||(t[5]=e("p",null,"Promo Discount",-1)),e("p",null,a(d.value),1)]),t[7]||(t[7]=e("hr",null,null,-1)),e("div",oe,[t[6]||(t[6]=e("p",null,"Total",-1)),e("p",null,a(o.value.price-d.value)+" TK",1)])]),t[11]||(t[11]=e("p",{class:"title-lg text-center"},"Enter Coupon Code",-1)),e("div",le,[g(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),class:"input-1",placeholder:"Enter coupon code"},null,512),[[S,m.value]]),e("button",{onClick:w,class:"btn-2"},"Apply")]),o.value.price-d.value>0?(c(),i(V,{key:0},[t[9]||(t[9]=e("p",{class:"title-lg text-center"},"Select payment method",-1)),e("div",ae,[e("label",ne,[g(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=l=>v.value=l),value:"bkash_payment"},null,512),[[j,v.value]]),t[8]||(t[8]=e("span",null,[e("img",{class:"w-52",src:$,alt:"Bkash Payment"})],-1))])])],64)):k("",!0),e("button",{class:"btn-2 mt-4",onClick:D},a(o.value.price-d.value>0?`Pay Now (${o.value.price-d.value} TK)`:"Checkout (Fee)"),1),x(y).error?(c(),i("div",ue,a(x(y).error),1)):k("",!0)])])])):(c(),i("div",re,"Loading..."))]))}};export{ve as default};
