import{J as S,r as w,K as k,ac as T,c as _,d as n,i as s,e,t as v,q as f,p as b,g as y,F as L,f as I,o as $,j as M}from"./index-uPh3lHus.js";const C=S("software-charge",()=>{const a=w(null),d=w([]),o=w([]),c=w(!1),u=r=>{const[m,l]=r.split("-").map(Number);return`${r}-${new Date(m,l,0).getDate()}`};return{error:a,isLoaded:c,payments:d,monthWiseTotalIncome:o,fetchMonthlyTotalIncome:async r=>{var l,i;const m={from:`${r}-01`,to:u(r)};try{const{data:g}=await k.get("/total-income",{params:m});return Number((g==null?void 0:g.total_income)??0).toFixed(2)}catch(g){throw a.value=((i=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:i.message)??"An error occurred",a.value}},fetchMonthWiseTotalIncome:async()=>{var r,m;try{const{data:l}=await k.get("/month-wise-total-income");o.value=l}catch(l){throw a.value=((m=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:m.message)??"An error occurred",a.value}},fetchPaidHistory:async()=>{var m,l;const r="https://ihsanit.com";try{const{data:i}=await T.get(`${r}/api/software-charges/paid/history`,{headers:{"Content-Type":"application/json"}});return c.value=!0,d.value=i,i}catch(i){throw a.value=((l=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:l.message)??"An error occurred",a.value}},paymentSoftwareCharge:async(r,m)=>{const i=`https://ihsanit.com/software-charges/payment/${r}/${m}`;return console.log(i),window.location=i}}}),P={class:"hover:bg-sky-700/15 *:px-1 *:py-1 *:border *:md:px-4 *:md:py-2"},j={class:"w-full flex gap-1 justify-between"},D={class:"w-full flex gap-1 justify-between"},A={key:0,class:"text-center animate-pulse"},N={key:1,class:"w-full flex gap-1 justify-between"},F={key:0,class:"text-center animate-pulse"},B={key:1,class:"w-full flex gap-1 justify-between"},R={key:2,class:"px-1.5 md:px-2.5 py-px rounded-xl border border-green-400 bg-green-100 text-green-600 font-mono text-xs md:text-sm"},U={key:0,class:"text-center animate-pulse"},W={key:1,class:"flex justify-center items-center gap-4"},H={key:1,class:"leading-tight"},V={key:2,class:"flex justify-center items-center gap-2 text-xs md:text-sm font-mono"},O={class:"inline-flex items-center gap-1 pt-px"},q={__name:"MonthlyTableRow",props:["monthIncome","percentage"],setup(a){const d=a,o=C(),c=_(()=>(d.monthIncome.total_income*d.percentage*.01).toFixed(0)),u=_(()=>{var t;return((t=o.payments)==null?void 0:t.filter(p=>p.month===d.monthIncome.month)).reduce((p,r)=>p+Number(r.paid_amount),0).toFixed(0)}),x=_(()=>{var h;return(h=o.payments)==null?void 0:h.filter(t=>t.month===d.monthIncome.month).map(t=>t.trx_id)});return(h,t)=>(s(),n("tr",P,[e("td",null,v(new Date(a.monthIncome.month+"-01").toLocaleString("default",{month:"short",year:"numeric"}).toUpperCase()),1),e("td",null,[e("div",j,[t[1]||(t[1]=e("span",null,"৳",-1)),f(" "+v(a.monthIncome.total_income),1)])]),e("td",null,[e("div",D,[t[2]||(t[2]=e("span",null,"৳",-1)),f(" "+v(c.value),1)])]),e("td",null,[y(o).isLoaded?b("",!0):(s(),n("div",A,"Loading...")),y(o).isLoaded&&u.value>0?(s(),n("div",N,[t[3]||(t[3]=e("span",null,"৳",-1)),f(" "+v(u.value),1)])):b("",!0)]),e("td",null,[y(o).isLoaded?c.value-u.value>0?(s(),n("div",B,[t[4]||(t[4]=e("span",null,"৳",-1)),f(" "+v((c.value-u.value).toFixed(0)),1)])):c.value>0?(s(),n("span",R," Paid ")):b("",!0):(s(),n("div",F,"Loading..."))]),e("td",null,[y(o).isLoaded?b("",!0):(s(),n("div",U,"Loading...")),y(o).isLoaded&&c.value-u.value>0?(s(),n("div",W,[a.monthIncome.month!==new Date().toISOString().slice(0,7)?(s(),n("button",{key:0,onClick:t[0]||(t[0]=p=>y(o).paymentSoftwareCharge(a.monthIncome.month,c.value-u.value)),class:"btn-2 px-2.5 pt-1 pb-0.5 text-xs md:text-sm"}," Pay Charge ")):(s(),n("div",H,t[5]||(t[5]=[e("div",null,"Processing...",-1),e("div",{class:"text-xs text-sky-700"},"Bill arrives month-end.",-1)])))])):y(o).isLoaded&&c.value>0?(s(),n("div",V,[e("span",O,[t[6]||(t[6]=e("span",{class:"text-gray-400"},"TrxID:",-1)),(s(!0),n(L,null,I(x.value,p=>(s(),n("span",{key:p},v(p),1))),128))])])):b("",!0)])]))}},E={class:"my-container space-y-4"},J={key:0,class:"text-center mt-2"},K={key:1,class:"text-red-500 text-center mb-4"},z={key:2,class:"overflow-x-auto"},G={class:"w-full table table-auto text-center text-xs md:text-base"},X={__name:"SoftwareCharge",setup(a){const d=C(),o=w(null),c=w(!1);return $(async()=>{await d.fetchMonthWiseTotalIncome(),await d.fetchPaidHistory()}),(u,x)=>(s(),n("div",E,[x[1]||(x[1]=e("h1",{class:"text-3xl font-bold mb-6 text-center"},"Software Charge",-1)),c.value?(s(),n("div",J,"Loading...")):o.value?(s(),n("div",K,v(o.value),1)):(s(),n("div",z,[e("table",G,[x[0]||(x[0]=e("thead",null,[e("tr",{class:"bg-gray-200 *:px-2 *:py-1.5"},[e("th",{class:"border"},"Month"),e("th",{class:"border"},[f("Total "),e("span",{class:"hidden md:inline"},"Transaction")]),e("th",{class:"border"},[e("span",{class:"hidden md:inline"},"Software"),f(" Charge")]),e("th",{class:"border"},[f("Paid "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},[f("Due "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},"Action")])],-1)),e("tbody",null,[(s(!0),n(L,null,I(y(d).monthWiseTotalIncome,h=>(s(),M(q,{key:h.month,monthIncome:h,percentage:5},null,8,["monthIncome"]))),128))])])]))]))}};export{X as default};
