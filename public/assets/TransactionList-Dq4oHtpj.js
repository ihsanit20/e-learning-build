import{r as l,Q as P,I as G,x as n,z as e,A as V,U as v,ag as U,a9 as f,F,G as M,B as b,X as y,C as o,y as r,M as Q}from"./vue-CcEtAIOs.js";import{a as $,d as q}from"./index-clbmm86J.js";import{u as H}from"./transaction-BBKchAKW.js";import"./vendor-PJuFQbji.js";const J={class:"container mx-auto p-4"},K={class:"mb-4 flex md:flex-row flex-col gap-4"},W=["value"],Y={class:"flex justify-center gap-4 text-sm"},Z={class:"font-semibold"},ee={class:"font-semibold"},te={class:"overflow-x-auto"},se={class:"min-w-full bg-white border border-gray-200 rounded-lg text-sm"},oe={key:0},ae={class:"py-0.5 px-2 border"},le={class:"py-0.5 px-2 border"},ne={class:"py-0.5 px-2 border"},re={class:"py-0.5 px-2 border"},ue=["onClick"],de={class:"py-0.5 px-2 border"},ie={class:"py-0.5 px-2 border text-green-600 font-semibold"},ce={class:"py-0.5 px-2 border"},pe={class:"py-0.5 px-2 border"},ve={key:2},be=["colspan"],ge={class:"mt-4 flex justify-between"},ye=["disabled"],xe=["disabled"],fe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},me={class:"bg-white rounded-lg p-6 w-96 shadow-lg"},he={key:0,class:"mb-4"},_e={class:"text-sm text-gray-600 mb-2"},Ce={class:"text-sm text-gray-600 mb-4"},we={class:"mb-4"},ke=["value"],De={class:"flex gap-3 justify-end"},Se=["disabled"],Te=["disabled"],Ie={__name:"TransactionList",setup(Pe){const u=H(),m=$(),A=q(),h=l(new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0]),_=l(new Date().toISOString().split("T")[0]),x=l(1),C=l("paid"),w=l(""),k=l(""),D=l(""),S=l(!1),T=l(!1),d=l(null),i=l(""),g=l(!1),B=P(()=>{var a;return((a=u.transactions.data)==null?void 0:a.length)||0}),X=P(()=>{var a;return((a=u.transactions.data)==null?void 0:a.reduce((t,p)=>t+parseFloat(p.paid_amount),0))||0}),c=async()=>{S.value=!0,await u.fetchTransactions({from:h.value,to:_.value,page:x.value,status:C.value,course_id:w.value,trx_id:k.value,phone:D.value}),S.value=!1};G(async()=>{await c(),await m.fetchCourses()});const z=()=>{u.transactions.next_page_url&&(x.value++,c())},O=()=>{u.transactions.prev_page_url&&(x.value--,c())},I=P(()=>{var a,t;return((a=A.user)==null?void 0:a.role)==="admin"||((t=A.user)==null?void 0:t.role)==="developer"}),R=a=>{d.value=a,i.value=a.course.id,T.value=!0},N=()=>{T.value=!1,d.value=null,i.value=""},E=async()=>{var a,t;if(!d.value||!i.value){alert("Please select a course");return}if(i.value===d.value.course.id){alert("Please select a different course");return}g.value=!0;try{await u.changeCourse(d.value.id,i.value),alert("Course changed successfully"),N(),await c()}catch(p){alert("Failed to change course: "+(((t=(a=p.response)==null?void 0:a.data)==null?void 0:t.message)||p.message))}finally{g.value=!1}};return(a,t)=>{var p,L,j;return r(),n("div",J,[t[17]||(t[17]=e("h1",{class:"text-2xl font-bold mb-4"},"Transaction List",-1)),e("div",K,[v(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>C.value=s),onChange:c,class:"input-1 w-full"},t[7]||(t[7]=[e("option",{value:"all"},"All",-1),e("option",{value:"paid"},"Paid",-1),e("option",{value:"free"},"Free",-1)]),544),[[U,C.value]]),v(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),class:"input-1 w-full",placeholder:"From Date"},null,512),[[f,h.value]]),v(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>_.value=s),class:"input-1 w-full",placeholder:"To Date"},null,512),[[f,_.value]]),v(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>w.value=s),onChange:c,class:"input-1 w-full"},[t[8]||(t[8]=e("option",{value:""},"Select Course",-1)),(r(!0),n(F,null,M(b(m).courses,s=>(r(),n("option",{key:s.id,value:s.id},o(s.title),9,W))),128))],544),[[U,w.value]]),v(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>k.value=s),class:"input-1 w-full",placeholder:"Search by TRX ID"},null,512),[[f,k.value]]),v(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>D.value=s),class:"input-1 w-full",placeholder:"Search by Phone"},null,512),[[f,D.value]]),e("button",{onClick:c,class:"btn-2"},"Filter")]),e("div",Y,[e("span",Z,"Visible Data: "+o(B.value),1),t[9]||(t[9]=y(" || ")),e("span",ee,"Total Amount: ৳ "+o(X.value.toFixed(2)),1)]),e("div",te,[e("table",se,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"bg-gray-200 text-left"},[e("th",{class:"py-0.5 px-2 border"},"Date"),e("th",{class:"py-0.5 px-2 border"},"User"),e("th",{class:"py-0.5 px-2 border"},"Phone"),e("th",{class:"py-0.5 px-2 border"},"Course"),e("th",{class:"py-0.5 px-2 border"},"TRX ID"),e("th",{class:"py-0.5 px-2 border"},"Paid Amount"),e("th",{class:"py-0.5 px-2 border"},"Coupon Code"),e("th",{class:"py-0.5 px-2 border"},"Discount")])],-1)),e("tbody",null,[S.value?(r(),n("tr",oe,t[10]||(t[10]=[e("td",{colspan:8,class:"text-center py-4"},[e("span",{class:"loader"}),y(" Loading transactions... ")],-1)]))):((j=(L=(p=b(u))==null?void 0:p.transactions)==null?void 0:L.data)==null?void 0:j.length)>0?(r(!0),n(F,{key:1},M(b(u).transactions.data,s=>(r(),n("tr",{key:s.id,class:"border-b"},[e("td",ae,o(s.date),1),e("td",le,o(s.user.name),1),e("td",ne,o(s.user.phone),1),e("td",re,[I.value?(r(),n("i",{key:0,class:"far fa-cog cursor-pointer text-gray-400 print:hidden mr-1",onClick:Q(Ve=>R(s),["self"])},null,8,ue)):V("",!0),y(" "+o(s.course.title),1)]),e("td",de,o(s.trx_id),1),e("td",ie," ৳ "+o(s.paid_amount),1),e("td",ce,o(s.coupon_code),1),e("td",pe,"৳ "+o(s.discount_amount),1)]))),128)):(r(),n("tr",ve,[e("td",{colspan:I.value?9:8,class:"text-center py-4"},"No transactions found",8,be)]))])])]),e("div",ge,[e("button",{onClick:O,disabled:!b(u).transactions.prev_page_url,class:"bg-gray-300 px-4 py-2 rounded disabled:opacity-50"}," Previous ",8,ye),e("span",null,"Page "+o(x.value)+" of "+o(b(u).transactions.last_page),1),e("button",{onClick:z,disabled:!b(u).transactions.next_page_url,class:"bg-gray-300 px-4 py-2 rounded disabled:opacity-50"}," Next ",8,xe)]),T.value?(r(),n("div",fe,[e("div",me,[t[16]||(t[16]=e("h2",{class:"text-xl font-bold mb-4"},"Change Course",-1)),d.value?(r(),n("div",he,[e("p",_e,[t[12]||(t[12]=e("strong",null,"User:",-1)),y(" "+o(d.value.user.name),1)]),e("p",Ce,[t[13]||(t[13]=e("strong",null,"Current Course:",-1)),y(" "+o(d.value.course.title),1)])])):V("",!0),e("div",we,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-2"},"Select New Course",-1)),v(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.value=s),class:"input-1 w-full"},[t[14]||(t[14]=e("option",{value:""},"-- Select Course --",-1)),(r(!0),n(F,null,M(b(m).courses,s=>(r(),n("option",{key:s.id,value:s.id},o(s.title),9,ke))),128))],512),[[U,i.value]])]),e("div",De,[e("button",{onClick:N,class:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400",disabled:g.value}," Cancel ",8,Se),e("button",{onClick:E,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",disabled:g.value},o(g.value?"Changing...":"Change Course"),9,Te)])])])):V("",!0)])}}};export{Ie as default};
