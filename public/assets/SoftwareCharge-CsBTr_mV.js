import{J as k,r as h,K as C,ac as S,c as _,o as b,d as n,p as f,i as o,t as g,F as w,e as s,q as x,g as y,f as $,j as M}from"./index-BRjg0X-h.js";const L=k("software-charge",()=>{const d=h(null),p=h([]),i=h(!1),m=t=>{const[l,e]=t.split("-").map(Number);return`${t}-${new Date(l,e,0).getDate()}`};return{error:d,isLoaded:i,payments:p,fetchMonthlyTotalIncome:async t=>{var e,a;const l={from:`${t}-01`,to:m(t)};try{const{data:u}=await C.get("/total-income",{params:l});return Number((u==null?void 0:u.total_income)??0).toFixed(2)}catch(u){throw d.value=((a=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:a.message)??"An error occurred",d.value}},fetchPaidHistory:async()=>{var l,e;const t="https://ihsanit.com";try{const{data:a}=await S.get(`${t}/api/software-charges/paid/history`,{headers:{"Content-Type":"application/json"}});return i.value=!0,p.value=a,a}catch(a){throw d.value=((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)??"An error occurred",d.value}},paymentSoftwareCharge:async(t,l)=>{const e="https://ihsanit.com";return window.location=`${e}/software-charges/payment/${t}/${l}`}}}),A={key:0},T={key:0,class:"border px-4 py-2 text-center animate-pulse",colspan:"6"},j={key:1,class:"border px-4 py-2 text-center text-red-500",colspan:"6"},D={class:"border px-4 py-2"},N={class:"border px-4 py-2"},P={class:"w-full flex gap-1 justify-between"},F={class:"border px-4 py-2"},I={class:"w-full flex gap-1 justify-between"},B={class:"border px-4 py-2"},H={key:0,class:"text-center animate-pulse"},R={key:1,class:"w-full flex gap-1 justify-between"},U={class:"border px-4 py-2"},V={key:0,class:"text-center animate-pulse"},O={key:1,class:"w-full flex gap-1 justify-between"},q={class:"border px-4 py-2"},E={key:0,class:"text-center animate-pulse"},J={key:1,class:"flex justify-center items-center gap-4"},K={__name:"MonthlyTableRow",props:["month","percentage"],setup(d){const p=d,i=h(null),m=h(!1),v=h(0),c=L(),r=_(()=>(v.value*p.percentage*.01).toFixed(2)),t=_(()=>{var e;return((e=c.payments)==null?void 0:e.filter(a=>a.month===p.month)).reduce((a,u)=>a+Number(u.paid_amount),0).toFixed(2)});return b(async()=>{var l,e;try{m.value=!0,v.value=await c.fetchMonthlyTotalIncome(p.month)}catch(a){i.value=((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"An error occurred"}finally{m.value=!1}}),(l,e)=>d.month?(o(),n("tr",A,[m.value?(o(),n("td",T,"Loading...")):i.value?(o(),n("td",j,g(i.value),1)):(o(),n(w,{key:2},[s("td",D,g(new Date(d.month+"-01").toLocaleString("default",{month:"short",year:"numeric"}).toUpperCase()),1),s("td",N,[s("div",P,[e[1]||(e[1]=s("span",null,"৳",-1)),x(" "+g(v.value),1)])]),s("td",F,[s("div",I,[e[2]||(e[2]=s("span",null,"৳",-1)),x(" "+g(r.value),1)])]),s("td",B,[y(c).isLoaded?f("",!0):(o(),n("div",H,"Loading...")),y(c).isLoaded&&t.value>0?(o(),n("div",R,[e[3]||(e[3]=s("span",null,"৳",-1)),x(" "+g(t.value),1)])):f("",!0)]),s("td",U,[y(c).isLoaded?f("",!0):(o(),n("div",V,"Loading...")),y(c).isLoaded&&r.value-t.value>0?(o(),n("div",O,[e[4]||(e[4]=s("span",null,"৳",-1)),x(" "+g((r.value-t.value).toFixed(2)),1)])):f("",!0)]),s("td",q,[y(c).isLoaded?f("",!0):(o(),n("div",E,"Loading...")),y(c).isLoaded&&r.value-t.value>0?(o(),n("div",J,[s("button",{onClick:e[0]||(e[0]=a=>y(c).paymentSoftwareCharge(d.month,r.value-t.value)),class:"btn-3"}," Pay Charge ")])):f("",!0)])],64))])):f("",!0)}},z={class:"my-container space-y-4"},G={key:0,class:"text-center mt-2"},Q={key:1,class:"text-red-500 text-center mb-4"},W={key:2,class:"w-full table table-auto text-center"},Y={__name:"SoftwareCharge",setup(d){const p=L(),i=h(null),m=h(!1),v=Array.from({length:12},(c,r)=>{const t=new Date;return t.setMonth(t.getMonth()-r),t.toISOString().slice(0,7)});return b(async()=>{await p.fetchPaidHistory()}),(c,r)=>(o(),n("div",z,[r[1]||(r[1]=s("h1",{class:"text-3xl font-bold mb-6 text-center"},"Software Charge",-1)),m.value?(o(),n("div",G,"Loading...")):i.value?(o(),n("div",Q,g(i.value),1)):(o(),n("table",W,[r[0]||(r[0]=s("thead",null,[s("tr",{class:"bg-gray-200"},[s("th",{class:"border px-4 py-2"},"Month"),s("th",{class:"border px-4 py-2"},"Total Transaction"),s("th",{class:"border px-4 py-2"},"Software Charge"),s("th",{class:"border px-4 py-2"},"Paid Amount"),s("th",{class:"border px-4 py-2"},"Due Amount"),s("th",{class:"border px-4 py-2"},"Action")])],-1)),s("tbody",null,[(o(!0),n(w,null,$(y(v),t=>(o(),M(K,{key:t,month:t,percentage:5},null,8,["month"]))),128))])]))]))}};export{Y as default};
