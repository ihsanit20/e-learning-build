import{P as j,r as n,Q as N,I as D,x as o,z as t,A as r,B as f,C as i,D as S,L as I,Z as $,F as w,U as E,a9 as q,X as F,ab as z,T as A,y as a}from"./vue-CAqJJQzZ.js";import{_ as O}from"./bkash_payment_logo-S19rnIIS.js";import{d as G,j as K}from"./index--DNSAfWm.js";import{u as Q}from"./purchase-DCn3JmCp.js";import"./vendor-PJuFQbji.js";const X={class:"max-w-xl mx-auto py-4"},Z={key:0,class:"space-y-4"},H={key:0,class:"text-center text-green-600 bg-green-600/20 p-4 rounded font-bold text-xl md:text-2xl"},J={class:"grid gap-4"},W={class:"card-bg"},Y={key:0,class:"flex justify-center items-center flex-col gap-2"},ee={key:1},te={class:"card-bg p-4 space-y-2 ml-auto"},se={key:0,class:"error text-rose-600"},oe={key:1,class:"border-black"},ae={key:1,class:"mt-4 flex gap-2"},le={key:0,class:"flex justify-center items-center flex-wrap"},ne={class:"border rounded px-2 pt-1.5 pb-0.5 mx-2"},re={class:"w-full flex items-center"},ue=["disabled"],de={key:0,class:"animate-spin border size-4 rounded-full"},ce={key:2,class:"error text-rose-600"},ie={class:"mt-2"},pe={class:"flex items-center space-x-4"},ve={key:4,class:"mt-2 text-red-600 font-bold text-center text-xl"},me={key:1,class:"flex justify-center items-center p-4"},ke={__name:"BundleCourseCheckOut",setup(ye){const x=j(),L=A(),C=x.query.message,B=G(),m=Q(),k=x.params.bundleId,u=n(null),d=n(null),y=n("bkash_payment"),R=n(null),_=n(x.query.for==="someone"),h=n(""),p=n(""),P=n(""),c=n(null),v=n(!1),V=N(()=>{var l;return(l=u.value)==null?void 0:l.is_purchased});D(async()=>{try{await B.fetchBundle(k),u.value=B.bundle}catch(l){d.value=l.message||"Failed to fetch bundle"}});const M=async()=>{var l,e;if(!h.value){c.value="Please enter a phone number";return}v.value=!0;try{const s=await m.findNotEnrolledUserByPhone(k,h.value);if(console.log("User found:",s),!s)throw new Error("User not found");c.value=null,p.value=s.id,P.value=s.name,v.value=!1}catch(s){c.value=((e=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:e.message)||s.message||"User not found",console.error("Error searching user:",c.value),v.value=!1}},T=async()=>{var l,e;try{if(y.value==="bkash_payment"){const s=await m.createBundlePayment(k,{coupon_code:(l=R.value)==null?void 0:l.code,user_id:_.value?p.value:null});console.log("Bkash payment response:",s),window.location=(e=s==null?void 0:s.data)==null?void 0:e.bkashURL}else y.value==="bank_transfer"&&(alert("Bank Transfer selected. Checkout completed successfully!"),L.push("/my/bundle"))}catch(s){d.value=s.message||"Failed to initiate payment",console.error("Error during checkout:",d.value)}},g=N(()=>u.value.bundle_courses.reduce((l,e)=>l+Number(e.course_price||0),0));return(l,e)=>{var U;const s=$("RouterLink");return a(),o("div",X,[u.value?(a(),o("div",Z,[e[12]||(e[12]=t("h1",{class:"title-xl text-center"},"Checkout Page",-1)),f(C)?(a(),o("div",H,i(f(C)),1)):r("",!0),t("div",J,[t("div",W,[S(K,{bundle:u.value},null,8,["bundle"])]),(U=u.value.purchased_course_ids)!=null&&U.length?(a(),o("div",Y,[S(s,{to:"/my/course",class:"btn-2"},{default:I(()=>e[4]||(e[4]=[F(" Go to My Course ")])),_:1})])):(a(),o("div",ee,[t("div",te,[d.value?(a(),o("div",se,i(d.value),1)):r("",!0),d.value?(a(),o("hr",oe)):r("",!0),t("div",null,[r("",!0),_.value?(a(),o("div",ae,[p.value?(a(),o("div",le,[e[6]||(e[6]=t("span",{class:"text-green-700"}," âœ“",-1)),t("b",ne,i(P.value),1),t("i",{onClick:e[1]||(e[1]=b=>p.value=null),class:"fas fa-trash text-red-600 ml-2 cursor-pointer"})])):(a(),o(w,{key:1},[t("div",re,[e[7]||(e[7]=t("span",{class:"input-1 max-w-max pl-3 pr-1 pt-2.5 pb-1.5 text-gray-600 bg-gray-200 rounded-r-none"}," +88 ",-1)),E(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=b=>h.value=b),class:"input-1 rounded-l-none px-1 pt-2.5 pb-1.5",placeholder:"Enter User Phone"},null,512),[[q,h.value]])]),t("button",{type:"button",onClick:M,class:"btn-2",disabled:v.value},[e[8]||(e[8]=F(" Search ")),v.value?(a(),o("span",de,".")):r("",!0)],8,ue)],64))])):r("",!0)]),c.value?(a(),o("div",ce,i(c.value),1)):r("",!0),!_.value&&!V.value||_.value&&p.value?(a(),o(w,{key:3},[e[11]||(e[11]=t("hr",{class:"border-black"},null,-1)),g.value>0?(a(),o(w,{key:0},[e[10]||(e[10]=t("p",{class:"title-lg text-center"},"Select payment method",-1)),t("div",ie,[t("label",pe,[E(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=b=>y.value=b),value:"bkash_payment"},null,512),[[z,y.value]]),e[9]||(e[9]=t("span",null,[t("img",{class:"w-52",src:O,alt:"Bkash Payment"})],-1))])])],64)):r("",!0),t("button",{class:"btn-2 mt-4",onClick:T},i(g.value>0?`Pay Now (${Number(g.value).toFixed()} TK)`:"Checkout (Fee)"),1)],64)):r("",!0),f(m).error?(a(),o("div",ve,i(f(m).error),1)):r("",!0)])]))])])):(a(),o("div",me,"Loading..."))])}}};export{ke as default};
