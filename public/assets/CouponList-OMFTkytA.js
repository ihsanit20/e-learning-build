import{u as F}from"./coupon-CWT9ZIRy.js";import{u as N,r as a,o as I,d as i,i as o,e,y as B,p as k,q as m,z as v,N as T,F as S,f as j,t as r,g as q,A as D,w as G,H as h,v as L,j as E,n as z}from"./index-uPh3lHus.js";import{u as K}from"./user-CIrmxcXb.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"modal"},H={class:"max-w-4-xl bg-white p-4 rounded-lg space-y-2"},J={class:"col-start-1"},O={key:0},Q=["value"],W={class:"col-start-1"},X={key:1},Y={class:"flex items-center"},Z={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ee={class:"col-start-1 col-span-full"},te=["value"],se={class:"col-start-1"},le={class:"flex items-center"},oe={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ne={class:"flex gap-4 col-span-full"},ae={__name:"AddCouponModal",emits:["close"],setup(M,{emit:w}){const c=w,f=F(),V=K(),y=N(),g=a(""),n=a("general"),b=a(""),U=a(""),p=a("percentage"),x=a(0),C=a(0),_=a(""),$=a(""),A=async()=>{await f.createCoupon({code:g.value,code_type:n.value,affiliate_user_id:b.value,course_id:U.value,discount_type:p.value,discount_value:C.value,commission_value:x.value,valid_from:_.value,valid_until:$.value}),c("close")};return I(async()=>{await V.fetchUsers({affiliate_status:"Active"}),await y.fetchCourses({price:"paid",fields:["id","title","price","category_id"]})}),(d,t)=>(o(),i("div",R,[e("div",H,[t[25]||(t[25]=e("h2",{class:"text-xl font-semibold"},"Add Coupon",-1)),t[26]||(t[26]=e("hr",{class:"col-span-full"},null,-1)),e("form",{onSubmit:B(A,["prevent"]),class:"grid md:grid-cols-2 gap-4"},[e("label",J,[t[11]||(t[11]=m(" Coupon Type ")),v(e("select",{class:"input-1","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s)},t[10]||(t[10]=[e("option",{value:"general"},"General",-1),e("option",{value:"affiliate"},"Affiliate",-1)]),512),[[T,n.value]])]),n.value==="affiliate"?(o(),i("label",O,[t[13]||(t[13]=m(" User ")),v(e("select",{class:"input-1","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),required:""},[t[12]||(t[12]=e("option",{value:""},"-- Select User --",-1)),(o(!0),i(S,null,j(q(V).users,s=>(o(),i("option",{key:s.id,value:s.id},r(`[${s.phone}] ${s.name}`),9,Q))),128))],512),[[T,b.value]])])):k("",!0),e("label",W,[t[14]||(t[14]=m(" Coupon code ")),v(e("input",{class:"input-1","onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),placeholder:"Coupon code",required:""},null,512),[[D,g.value]])]),n.value==="affiliate"?(o(),i("label",X,[t[15]||(t[15]=m(" Commission value ")),e("div",Y,[v(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[3]||(t[3]=s=>x.value=s),type:"number",required:""},null,512),[[D,x.value]]),e("div",Z,r(p.value==="percentage"?"%":"TK"),1)])])):k("",!0),e("label",ee,[t[17]||(t[17]=m(" Course: ")),v(e("select",{class:"input-1","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s)},[t[16]||(t[16]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,j(q(y).courses,s=>(o(),i(S,{key:s.id},[s.price>0?(o(),i("option",{key:0,value:s.id},r(`[${s.id}] ${s.title}`),9,te)):k("",!0)],64))),128))],512),[[T,U.value]])]),e("label",se,[t[19]||(t[19]=m(" Discount Type ")),v(e("select",{class:"input-1","onUpdate:modelValue":t[5]||(t[5]=s=>p.value=s)},t[18]||(t[18]=[e("option",{value:"percentage"},"Percentage",-1),e("option",{value:"fixed"},"Fixed Amount",-1)]),512),[[T,p.value]])]),e("label",null,[t[20]||(t[20]=m(" Discount Amount ")),e("div",le,[v(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[6]||(t[6]=s=>C.value=s),placeholder:"Discount value",type:"number",required:""},null,512),[[D,C.value]]),e("div",oe,r(p.value==="percentage"?"%":"TK"),1)])]),e("label",null,[t[21]||(t[21]=m(" Valid From ")),v(e("input",{class:"input-1","onUpdate:modelValue":t[7]||(t[7]=s=>_.value=s),placeholder:"Valid from",type:"date",required:""},null,512),[[D,_.value]])]),e("label",null,[t[22]||(t[22]=m(" Valid Until ")),v(e("input",{class:"input-1","onUpdate:modelValue":t[8]||(t[8]=s=>$.value=s),placeholder:"Valid until",type:"date",required:""},null,512),[[D,$.value]])]),t[24]||(t[24]=e("hr",{class:"col-span-full"},null,-1)),e("div",ne,[t[23]||(t[23]=e("button",{type:"submit",class:"btn-2"},"Add",-1)),e("button",{type:"button",onClick:t[9]||(t[9]=s=>c("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},ie={class:"modal"},ue={class:"modal-content space-y-2"},de={class:"flex gap-4"},re={__name:"DeleteCouponModal",props:["coupon"],emits:["close"],setup(M,{emit:w}){const c=M,f=w,V=F(),y=async()=>{await V.deleteCoupon(c.coupon.id),f("close")};return(g,n)=>(o(),i("div",ie,[e("div",ue,[n[3]||(n[3]=e("h2",null,"Delete Coupon",-1)),e("p",null,[n[1]||(n[1]=m("Are you sure you want to delete the coupon ")),e("strong",null,r(M.coupon.code),1),n[2]||(n[2]=m("?"))]),e("div",de,[e("button",{type:"button",class:"btn-2",onClick:y},"Delete"),e("button",{type:"button",onClick:n[0]||(n[0]=b=>f("close")),class:"btn-contrast"},"Cancel")])])]))}},pe={class:"modal"},ve={class:"max-w-2xl z-50 card-bg p-4 md:p-8 space-y-2"},ce={class:"flex flex-wrap justify-between items-center gap-2"},me={class:"border rounded-lg px-3 pt-2 pb-1 font-semibold text-black"},fe={class:"capitalize border rounded-lg px-3 pt-2 pb-1"},ye={key:0,class:"border rounded-lg px-3 pt-2 pb-1"},be={class:"col-start-1 col-span-full block"},_e=["value"],ge={class:"grid md:grid-cols-4 gap-3 items-end"},xe={class:"md:col-span-3 border pt-3 pb-2 rounded-lg px-2"},Ce={class:"flex justify-center items-center gap-3"},$e={class:"flex items-center cursor-pointer"},ke={class:"flex items-center cursor-pointer"},we={class:"relative"},Ve={class:"absolute top-2 right-3"},De={key:0},Ue={class:"relative"},Me={class:"absolute top-2 right-3"},Ae={class:"grid md:grid-cols-2 gap-3"},Se={class:"flex justify-center gap-4"},Te={__name:"EditCouponModal",props:["coupon"],emits:["close"],setup(M,{emit:w}){const c=M,f=w,V=F(),y=N(),g=a(""),n=a(""),b=a("general"),U=a(""),p=a("percentage"),x=a(0),C=a(0),_=a(""),$=a(""),A=s=>L(new Date(s),"yyyy-MM-dd"),d=s=>{g.value=s.code,n.value=s.course_id||"",b.value=s.code_type,U.value=s.affiliate_user_id,p.value=s.discount_type,x.value=s.discount_value,C.value=s.commission_value,_.value=A(s.valid_from),$.value=A(s.valid_until)};G(c.coupon,s=>{d(s)}),I(async()=>{await y.fetchCourses({price:"paid",fields:["id","title","price","category_id"]}),c.coupon&&d(c.coupon)});const t=async()=>{await V.updateCoupon(c.coupon.id,{course_id:n.value,discount_type:p.value,discount_value:x.value,commission_value:C.value,valid_from:_.value,valid_until:$.value}),f("close")};return(s,l)=>(o(),i("div",pe,[e("div",ve,[l[19]||(l[19]=e("h2",{class:"title-lg"},"Edit Coupon",-1)),e("form",{onSubmit:B(t,["prevent"]),class:"space-y-4"},[e("div",ce,[e("p",me,r(g.value),1),e("p",fe,"Type: "+r(b.value),1),b.value==="affiliate"?(o(),i("p",ye," User ID: "+r(U.value),1)):k("",!0)]),e("label",be,[l[9]||(l[9]=m(" Course: ")),v(e("select",{class:"input-1","onUpdate:modelValue":l[0]||(l[0]=u=>n.value=u)},[l[8]||(l[8]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,j(q(y).courses,u=>(o(),i(S,{key:u.id},[u.price>0?(o(),i("option",{key:0,value:u.id},r(`[${u.id}] ${u.title}`),9,_e)):k("",!0)],64))),128))],512),[[T,n.value]])]),e("div",ge,[e("div",xe,[l[13]||(l[13]=e("p",{class:"md:hidden text-gray-500"},"Discount type:",-1)),e("div",Ce,[l[12]||(l[12]=e("p",{class:"hidden md:block text-gray-500"},"Discount type:",-1)),e("label",$e,[v(e("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=u=>p.value=u),value:"percentage",class:"form-radio"},null,512),[[h,p.value]]),l[10]||(l[10]=e("span",{class:"ml-2"},"Percentage",-1))]),e("label",ke,[v(e("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=u=>p.value=u),value:"fixed",class:"form-radio"},null,512),[[h,p.value]]),l[11]||(l[11]=e("span",{class:"ml-2"},"Fixed Amount",-1))])])]),e("div",null,[l[14]||(l[14]=e("p",null,"Discount value",-1)),e("div",we,[v(e("input",{class:"input-1","onUpdate:modelValue":l[3]||(l[3]=u=>x.value=u),placeholder:"Discount value",type:"number",required:""},null,512),[[D,x.value]]),e("span",Ve,r(p.value==="percentage"?"%":"Tk"),1)])]),b.value==="affiliate"?(o(),i("div",De,[l[15]||(l[15]=e("p",null,"Commission value",-1)),e("div",Ue,[v(e("input",{class:"input-1","onUpdate:modelValue":l[4]||(l[4]=u=>C.value=u),placeholder:"Commission value",type:"number",required:""},null,512),[[D,C.value]]),e("span",Me,r(p.value==="percentage"?"%":"Tk"),1)])])):k("",!0)]),e("div",Ae,[e("div",null,[l[16]||(l[16]=e("p",null,"Valid from",-1)),v(e("input",{class:"input-1","onUpdate:modelValue":l[5]||(l[5]=u=>_.value=u),placeholder:"Valid from",type:"date",required:""},null,512),[[D,_.value]])]),e("div",null,[l[17]||(l[17]=e("p",null,"Valid to",-1)),v(e("input",{class:"input-1","onUpdate:modelValue":l[6]||(l[6]=u=>$.value=u),placeholder:"Valid until",type:"date",required:""},null,512),[[D,$.value]])])]),e("div",Se,[l[18]||(l[18]=e("button",{type:"submit",class:"btn-2"},"Save",-1)),e("button",{type:"button",onClick:l[7]||(l[7]=u=>f("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},qe=P(Te,[["__scopeId","data-v-326e68dc"]]),je={class:"my-container space-y-2"},Fe={class:"flex justify-between"},Ee={class:"flex items-center gap-4"},ze={class:"card-bg p-2"},Ie={key:0,class:"flex justify-center items-center"},he={key:1},Ne={key:0,class:"table-auto w-full"},Be={class:""},Le={class:"text-center max-w-xs"},Ge={class:"text-center"},Ke={class:"text-center"},Pe={key:0},Re={key:1},He={class:""},Je={class:""},Oe={class:""},Qe={class:"flex justify-center gap-2"},We=["onClick"],Xe={key:1,class:"text-red-500"},st={__name:"CouponList",setup(M){const w=F(),c=a(!1),f=a(!1),V=a(!1),y=a(null),g=a(!0),n=a("general"),b=()=>c.value=!0,U=()=>c.value=!1,p=d=>{y.value=d,f.value=!0},x=()=>f.value=!1,C=()=>V.value=!1,_=d=>L(new Date(d),"dd-MMM-yyyy"),$=d=>{if(!(d!=null&&d.valid_from)||!(d!=null&&d.valid_until))return!1;const t=new Date,s=new Date(d.valid_from),l=new Date(d.valid_until);return t>=s&&t<=l},A=d=>({"bg-sky-700/40":d.highlight,"text-gray-400":!$(d)});return I(async()=>{try{await w.fetchCoupons()}finally{g.value=!1}}),(d,t)=>(o(),i("div",je,[e("div",Fe,[e("div",Ee,[e("button",{class:z(n.value==="general"?"btn-2":"btn-1"),type:"button",onClick:t[0]||(t[0]=s=>n.value="general")}," General Coupons ",2),e("button",{class:z(n.value==="affiliate"?"btn-2":"btn-1"),type:"button",onClick:t[1]||(t[1]=s=>n.value="affiliate")}," Affiliate Coupons ",2)]),e("button",{class:"btn-2",onClick:b},"Add Coupon")]),e("div",ze,[g.value?(o(),i("div",Ie,t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-gray-900"},null,-1)]))):(o(),i("div",he,[q(w).coupons.length?(o(),i("table",Ne,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"text-left *:px-3 *:py-1"},[e("th",{class:""},"Code"),e("th",{class:"text-center"},"Course"),e("th",{class:"text-center"},"Discount Type"),e("th",{class:"text-center"},"Discount Value"),e("th",{class:""},"Valid From"),e("th",{class:""},"Valid Until"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[(o(!0),i(S,null,j(q(w).coupons.filter(s=>s.code_type===n.value),s=>{var l;return o(),i("tr",{key:s.id,class:z(["border-t *:px-3 *:py-0.5 text-sm hover:bg-sky-700/30",A(s)])},[e("td",Be,r(s.code),1),e("td",Le," ["+r(s.course_id||"*")+"] "+r(((l=s==null?void 0:s.course)==null?void 0:l.title)||"All Course"),1),e("td",Ge,r(s.discount_type),1),e("td",Ke,[m(r(s.discount_value)+" ",1),s.discount_type==="percentage"?(o(),i("span",Pe,"%")):(o(),i("span",Re,"Tk"))]),e("td",He,r(_(s.valid_from)),1),e("td",Je,r(_(s.valid_until)),1),e("td",Oe,[e("div",Qe,[e("button",{onClick:u=>p(s),class:"btn-1 px-4 pt-1 py-0 text-xs"}," Edit ",8,We),k("",!0)])])],2)}),128))])])):(o(),i("p",Xe,"No coupons found"))]))]),c.value?(o(),E(ae,{key:0,class:"z-40",onClose:U})):k("",!0),f.value?(o(),E(qe,{key:1,class:"z-40",coupon:y.value,onClose:x},null,8,["coupon"])):k("",!0),V.value?(o(),E(re,{key:2,class:"z-40",coupon:y.value,onClose:C},null,8,["coupon"])):k("",!0)]))}};export{st as default};
