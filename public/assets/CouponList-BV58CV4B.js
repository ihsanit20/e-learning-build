import{u as F}from"./coupon-DudQh117.js";import{u as h,r as a,o as I,d as i,i as o,e,y as B,p as V,q as y,z as c,N as T,F as S,f as j,t as r,g as q,A as D,w as G,H as N,v as L,j as E,n as z}from"./index-DS0PwgrE.js";import{u as K}from"./user-hgDNnQWc.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"modal"},R={class:"max-w-4-xl bg-white p-4 rounded-lg space-y-2"},J={class:"col-start-1"},O={key:0},Q=["value"],W={class:"col-start-1"},X={key:1},Y={class:"flex items-center"},Z={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ee={class:"col-start-1 col-span-full"},te=["value"],se={class:"col-start-1"},le={class:"flex items-center"},oe={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ne={class:"flex gap-4 col-span-full"},ae={__name:"AddCouponModal",emits:["close"],setup(A,{emit:w}){const v=w,b=F(),U=K(),_=h(),$=a(""),n=a("general"),x=a(""),M=a(""),p=a("percentage"),C=a(0),k=a(0),g=a(""),m=a(""),f=async()=>{await b.createCoupon({code:$.value,code_type:n.value,affiliate_user_id:x.value,course_id:M.value,discount_type:p.value,discount_value:k.value,commission_value:C.value,valid_from:g.value,valid_until:m.value}),v("close")};return I(async()=>{await U.fetchUsers({affiliate_status:"Active"}),await _.fetchCourses({price:"paid",fields:["id","title","price","category_id"]})}),(u,t)=>(o(),i("div",H,[e("div",R,[t[25]||(t[25]=e("h2",{class:"text-xl font-semibold"},"Add Coupon",-1)),t[26]||(t[26]=e("hr",{class:"col-span-full"},null,-1)),e("form",{onSubmit:B(f,["prevent"]),class:"grid md:grid-cols-2 gap-4"},[e("label",J,[t[11]||(t[11]=y(" Coupon Type ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s)},t[10]||(t[10]=[e("option",{value:"general"},"General",-1),e("option",{value:"affiliate"},"Affiliate",-1)]),512),[[T,n.value]])]),n.value==="affiliate"?(o(),i("label",O,[t[13]||(t[13]=y(" User ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),required:""},[t[12]||(t[12]=e("option",{value:""},"-- Select User --",-1)),(o(!0),i(S,null,j(q(U).users,s=>(o(),i("option",{key:s.id,value:s.id},r(`[${s.phone}] ${s.name}`),9,Q))),128))],512),[[T,x.value]])])):V("",!0),e("label",W,[t[14]||(t[14]=y(" Coupon code ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[2]||(t[2]=s=>$.value=s),placeholder:"Coupon code",required:""},null,512),[[D,$.value]])]),n.value==="affiliate"?(o(),i("label",X,[t[15]||(t[15]=y(" Commission value ")),e("div",Y,[c(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),type:"number",required:""},null,512),[[D,C.value]]),e("div",Z,r(p.value==="percentage"?"%":"TK"),1)])])):V("",!0),e("label",ee,[t[17]||(t[17]=y(" Course: ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[4]||(t[4]=s=>M.value=s)},[t[16]||(t[16]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,j(q(_).courses,s=>(o(),i(S,{key:s.id},[s.price>0?(o(),i("option",{key:0,value:s.id},r(`[${s.id}] ${s.title}`),9,te)):V("",!0)],64))),128))],512),[[T,M.value]])]),e("label",se,[t[19]||(t[19]=y(" Discount Type ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[5]||(t[5]=s=>p.value=s)},t[18]||(t[18]=[e("option",{value:"percentage"},"Percentage",-1),e("option",{value:"fixed"},"Fixed Amount",-1)]),512),[[T,p.value]])]),e("label",null,[t[20]||(t[20]=y(" Discount Amount ")),e("div",le,[c(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[6]||(t[6]=s=>k.value=s),placeholder:"Discount value",type:"number",required:""},null,512),[[D,k.value]]),e("div",oe,r(p.value==="percentage"?"%":"TK"),1)])]),e("label",null,[t[21]||(t[21]=y(" Valid From ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[7]||(t[7]=s=>g.value=s),placeholder:"Valid from",type:"date",required:""},null,512),[[D,g.value]])]),e("label",null,[t[22]||(t[22]=y(" Valid Until ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[8]||(t[8]=s=>m.value=s),placeholder:"Valid until",type:"date",required:""},null,512),[[D,m.value]])]),t[24]||(t[24]=e("hr",{class:"col-span-full"},null,-1)),e("div",ne,[t[23]||(t[23]=e("button",{type:"submit",class:"btn-2"},"Add",-1)),e("button",{type:"button",onClick:t[9]||(t[9]=s=>v("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},ie={class:"modal"},ue={class:"modal-content space-y-2"},de={class:"flex gap-4"},re={__name:"DeleteCouponModal",props:["coupon"],emits:["close"],setup(A,{emit:w}){const v=A,b=w,U=F(),_=async()=>{await U.deleteCoupon(v.coupon.id),b("close")};return($,n)=>(o(),i("div",ie,[e("div",ue,[n[3]||(n[3]=e("h2",null,"Delete Coupon",-1)),e("p",null,[n[1]||(n[1]=y("Are you sure you want to delete the coupon ")),e("strong",null,r(A.coupon.code),1),n[2]||(n[2]=y("?"))]),e("div",de,[e("button",{type:"button",class:"btn-2",onClick:_},"Delete"),e("button",{type:"button",onClick:n[0]||(n[0]=x=>b("close")),class:"btn-contrast"},"Cancel")])])]))}},pe={class:"modal"},ce={class:"max-w-2xl z-50 card-bg p-4 md:p-8 space-y-2"},ve={class:"flex flex-wrap justify-between items-center gap-2"},me={class:"border rounded-lg px-3 pt-2 pb-1 font-semibold text-black"},fe={class:"capitalize border rounded-lg px-3 pt-2 pb-1"},ye={key:0,class:"border rounded-lg px-3 pt-2 pb-1"},be={class:"col-start-1 col-span-full block"},_e=["value"],xe={class:"grid md:grid-cols-4 gap-3 items-end"},ge={class:"md:col-span-3 border pt-3 pb-2 rounded-lg px-2"},$e={class:"flex justify-center items-center gap-3"},Ce={class:"flex items-center cursor-pointer"},ke={class:"flex items-center cursor-pointer"},Ve={class:"relative"},we={class:"absolute top-2 right-3"},Ue={key:0},De={class:"relative"},Me={class:"absolute top-2 right-3"},Ae={class:"grid md:grid-cols-2 gap-3"},Se={class:"flex justify-center gap-4"},Te={__name:"EditCouponModal",props:["coupon"],emits:["close"],setup(A,{emit:w}){const v=A,b=w,U=F(),_=h(),$=a(""),n=a(""),x=a("general"),M=a(""),p=a("percentage"),C=a(0),k=a(0),g=a(""),m=a(""),f=s=>L(new Date(s),"yyyy-MM-dd"),u=s=>{$.value=s.code,n.value=s.course_id||"",x.value=s.code_type,M.value=s.affiliate_user_id,p.value=s.discount_type,C.value=s.discount_value,k.value=s.commission_value,g.value=f(s.valid_from),m.value=f(s.valid_until)};G(v.coupon,s=>{u(s)}),I(async()=>{await _.fetchCourses({price:"paid",fields:["id","title","price","category_id"]}),v.coupon&&u(v.coupon)});const t=async()=>{await U.updateCoupon(v.coupon.id,{course_id:n.value,discount_type:p.value,discount_value:C.value,commission_value:k.value,valid_from:g.value,valid_until:m.value}),b("close")};return(s,l)=>(o(),i("div",pe,[e("div",ce,[l[19]||(l[19]=e("h2",{class:"title-lg"},"Edit Coupon",-1)),e("form",{onSubmit:B(t,["prevent"]),class:"space-y-4"},[e("div",ve,[e("p",me,r($.value),1),e("p",fe,"Type: "+r(x.value),1),x.value==="affiliate"?(o(),i("p",ye," User ID: "+r(M.value),1)):V("",!0)]),e("label",be,[l[9]||(l[9]=y(" Course: ")),c(e("select",{class:"input-1","onUpdate:modelValue":l[0]||(l[0]=d=>n.value=d)},[l[8]||(l[8]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,j(q(_).courses,d=>(o(),i(S,{key:d.id},[d.price>0?(o(),i("option",{key:0,value:d.id},r(`[${d.id}] ${d.title}`),9,_e)):V("",!0)],64))),128))],512),[[T,n.value]])]),e("div",xe,[e("div",ge,[l[13]||(l[13]=e("p",{class:"md:hidden text-gray-500"},"Discount type:",-1)),e("div",$e,[l[12]||(l[12]=e("p",{class:"hidden md:block text-gray-500"},"Discount type:",-1)),e("label",Ce,[c(e("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=d=>p.value=d),value:"percentage",class:"form-radio"},null,512),[[N,p.value]]),l[10]||(l[10]=e("span",{class:"ml-2"},"Percentage",-1))]),e("label",ke,[c(e("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=d=>p.value=d),value:"fixed",class:"form-radio"},null,512),[[N,p.value]]),l[11]||(l[11]=e("span",{class:"ml-2"},"Fixed Amount",-1))])])]),e("div",null,[l[14]||(l[14]=e("p",null,"Discount value",-1)),e("div",Ve,[c(e("input",{class:"input-1","onUpdate:modelValue":l[3]||(l[3]=d=>C.value=d),placeholder:"Discount value",type:"number",required:""},null,512),[[D,C.value]]),e("span",we,r(p.value==="percentage"?"%":"Tk"),1)])]),x.value==="affiliate"?(o(),i("div",Ue,[l[15]||(l[15]=e("p",null,"Commission value",-1)),e("div",De,[c(e("input",{class:"input-1","onUpdate:modelValue":l[4]||(l[4]=d=>k.value=d),placeholder:"Commission value",type:"number",required:""},null,512),[[D,k.value]]),e("span",Me,r(p.value==="percentage"?"%":"Tk"),1)])])):V("",!0)]),e("div",Ae,[e("div",null,[l[16]||(l[16]=e("p",null,"Valid from",-1)),c(e("input",{class:"input-1","onUpdate:modelValue":l[5]||(l[5]=d=>g.value=d),placeholder:"Valid from",type:"date",required:""},null,512),[[D,g.value]])]),e("div",null,[l[17]||(l[17]=e("p",null,"Valid to",-1)),c(e("input",{class:"input-1","onUpdate:modelValue":l[6]||(l[6]=d=>m.value=d),placeholder:"Valid until",type:"date",required:""},null,512),[[D,m.value]])])]),e("div",Se,[l[18]||(l[18]=e("button",{type:"submit",class:"btn-2"},"Save",-1)),e("button",{type:"button",onClick:l[7]||(l[7]=d=>b("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},qe=P(Te,[["__scopeId","data-v-326e68dc"]]),je={class:"my-container space-y-2"},Fe={class:"flex justify-between"},Ee={class:"flex items-center gap-4"},ze={class:"card-bg p-2"},Ie={key:0,class:"flex justify-center items-center"},Ne={key:1},he={key:0,class:"table-auto w-full"},Be={class:""},Le={class:"text-center max-w-xs"},Ge={class:"text-center"},Ke={class:"text-center"},Pe={key:0},He={key:1},Re={class:""},Je={class:""},Oe={class:""},Qe={class:"flex justify-center gap-2"},We=["onClick"],Xe={key:1,class:"text-red-500"},st={__name:"CouponList",setup(A){const w=F(),v=a(!1),b=a(!1),U=a(!1),_=a(null),$=a(!0),n=a("general"),x=()=>v.value=!0,M=()=>v.value=!1,p=m=>{_.value=m,b.value=!0},C=()=>b.value=!1,k=()=>U.value=!1,g=m=>L(new Date(m),"dd-MMM-yyyy");return I(async()=>{try{await w.fetchCoupons()}finally{$.value=!1}}),(m,f)=>(o(),i("div",je,[e("div",Fe,[e("div",Ee,[e("button",{class:z(n.value==="general"?"btn-2":"btn-1"),type:"button",onClick:f[0]||(f[0]=u=>n.value="general")}," General Coupons ",2),e("button",{class:z(n.value==="affiliate"?"btn-2":"btn-1"),type:"button",onClick:f[1]||(f[1]=u=>n.value="affiliate")}," Affiliate Coupons ",2)]),e("button",{class:"btn-2",onClick:x},"Add Coupon")]),e("div",ze,[$.value?(o(),i("div",Ie,f[2]||(f[2]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-gray-900"},null,-1)]))):(o(),i("div",Ne,[q(w).coupons.length?(o(),i("table",he,[f[3]||(f[3]=e("thead",null,[e("tr",{class:"text-left *:px-3 *:py-1"},[e("th",{class:""},"Code"),e("th",{class:"text-center"},"Course"),e("th",{class:"text-center"},"Discount Type"),e("th",{class:"text-center"},"Discount Value"),e("th",{class:""},"Valid From"),e("th",{class:""},"Valid Until"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[(o(!0),i(S,null,j(q(w).coupons.filter(u=>u.code_type===n.value),u=>{var t;return o(),i("tr",{key:u.id,class:z(["border-t *:px-3 *:py-0.5 text-sm hover:bg-sky-700/30",{"bg-sky-700/40":u.highlight}])},[e("td",Be,r(u.code),1),e("td",Le," ["+r(u.course_id||"*")+"] "+r(((t=u==null?void 0:u.course)==null?void 0:t.title)||"All Course"),1),e("td",Ge,r(u.discount_type),1),e("td",Ke,[y(r(u.discount_value)+" ",1),u.discount_type==="percentage"?(o(),i("span",Pe,"%")):(o(),i("span",He,"Tk"))]),e("td",Re,r(g(u.valid_from)),1),e("td",Je,r(g(u.valid_until)),1),e("td",Oe,[e("div",Qe,[e("button",{onClick:s=>p(u),class:"btn-1 px-4 pt-1 py-0 text-xs"}," Edit ",8,We),V("",!0)])])],2)}),128))])])):(o(),i("p",Xe,"No coupons found"))]))]),v.value?(o(),E(ae,{key:0,class:"z-40",onClose:M})):V("",!0),b.value?(o(),E(qe,{key:1,class:"z-40",coupon:_.value,onClose:C},null,8,["coupon"])):V("",!0),U.value?(o(),E(re,{key:2,class:"z-40",coupon:_.value,onClose:k},null,8,["coupon"])):V("",!0)]))}};export{st as default};
