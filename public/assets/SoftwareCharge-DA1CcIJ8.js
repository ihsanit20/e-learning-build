import{J as T,r as w,K as k,ac as $,c as _,d as n,i as s,e,t as v,q as f,p as b,g as y,F as L,f as C,o as S,j as M}from"./index-DS0PwgrE.js";const I=T("software-charge",()=>{const l=w(null),i=w([]),a=w([]),c=w(!1),u=r=>{const[d,o]=r.split("-").map(Number);return`${r}-${new Date(d,o,0).getDate()}`};return{error:l,isLoaded:c,payments:i,monthWiseTotalIncome:a,fetchMonthlyTotalIncome:async r=>{var o,h;const d={from:`${r}-01`,to:u(r)};try{const{data:g}=await k.get("/total-income",{params:d});return Number((g==null?void 0:g.total_income)??0).toFixed(2)}catch(g){throw l.value=((h=(o=g==null?void 0:g.response)==null?void 0:o.data)==null?void 0:h.message)??"An error occurred",l.value}},fetchMonthWiseTotalIncome:async()=>{var r,d;try{const{data:o}=await k.get("/month-wise-total-income");a.value=o}catch(o){throw l.value=((d=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:d.message)??"An error occurred",l.value}},fetchPaidHistory:async()=>{var d,o;const r="https://ihsanit.com";try{const{data:h}=await $.get(`${r}/api/software-charges/paid/history`,{headers:{"Content-Type":"application/json"}});return c.value=!0,i.value=h,h}catch(h){throw l.value=((o=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:o.message)??"An error occurred",l.value}},paymentSoftwareCharge:async(r,d)=>{const o="https://ihsanit.com";return window.location=`${o}/software-charges/payment/${r}/${d}`}}}),j={class:"hover:bg-sky-700/15 *:px-1 *:py-1 *:border *:md:px-4 *:md:py-2"},P={class:"w-full flex gap-1 justify-between"},A={class:"w-full flex gap-1 justify-between"},D={key:0,class:"text-center animate-pulse"},N={key:1,class:"w-full flex gap-1 justify-between"},F={key:0,class:"text-center animate-pulse"},W={key:1,class:"w-full flex gap-1 justify-between"},B={key:2,class:"px-1.5 md:px-2.5 py-px rounded-xl border border-green-400 bg-green-100 text-green-600 font-mono text-xs md:text-sm"},H={key:0,class:"text-center animate-pulse"},R={key:1,class:"flex justify-center items-center gap-4"},U={key:2,class:"flex justify-center items-center gap-2 text-xs md:text-sm font-mono"},V={class:"inline-flex items-center gap-1 pt-px"},q={__name:"MonthlyTableRow",props:["monthIncome","percentage"],setup(l){const i=l,a=I(),c=_(()=>(i.monthIncome.total_income*i.percentage*.01).toFixed(0)),u=_(()=>{var t;return((t=a.payments)==null?void 0:t.filter(p=>p.month===i.monthIncome.month)).reduce((p,r)=>p+Number(r.paid_amount),0).toFixed(0)}),x=_(()=>{var m;return(m=a.payments)==null?void 0:m.filter(t=>t.month===i.monthIncome.month).map(t=>t.trx_id)});return(m,t)=>(s(),n("tr",j,[e("td",null,v(new Date(l.monthIncome.month+"-01").toLocaleString("default",{month:"short",year:"numeric"}).toUpperCase()),1),e("td",null,[e("div",P,[t[1]||(t[1]=e("span",null,"৳",-1)),f(" "+v(l.monthIncome.total_income),1)])]),e("td",null,[e("div",A,[t[2]||(t[2]=e("span",null,"৳",-1)),f(" "+v(c.value),1)])]),e("td",null,[y(a).isLoaded?b("",!0):(s(),n("div",D,"Loading...")),y(a).isLoaded&&u.value>0?(s(),n("div",N,[t[3]||(t[3]=e("span",null,"৳",-1)),f(" "+v(u.value),1)])):b("",!0)]),e("td",null,[y(a).isLoaded?c.value-u.value>0?(s(),n("div",W,[t[4]||(t[4]=e("span",null,"৳",-1)),f(" "+v((c.value-u.value).toFixed(0)),1)])):c.value>0?(s(),n("span",B," Paid ")):b("",!0):(s(),n("div",F,"Loading..."))]),e("td",null,[y(a).isLoaded?b("",!0):(s(),n("div",H,"Loading...")),y(a).isLoaded&&c.value-u.value>0?(s(),n("div",R,[e("button",{onClick:t[0]||(t[0]=p=>y(a).paymentSoftwareCharge(m.month,c.value-u.value)),class:"btn-2 px-2.5 pt-1 pb-0.5 text-xs md:text-sm"}," Pay Charge ")])):y(a).isLoaded&&c.value>0?(s(),n("div",U,[e("span",V,[t[5]||(t[5]=e("span",{class:"text-gray-400"},"TrxID:",-1)),(s(!0),n(L,null,C(x.value,p=>(s(),n("span",{key:p},v(p),1))),128))])])):b("",!0)])]))}},E={class:"my-container space-y-4"},J={key:0,class:"text-center mt-2"},K={key:1,class:"text-red-500 text-center mb-4"},O={key:2,class:"overflow-x-auto"},z={class:"w-full table table-auto text-center text-xs md:text-base"},Q={__name:"SoftwareCharge",setup(l){const i=I(),a=w(null),c=w(!1);return S(async()=>{await i.fetchMonthWiseTotalIncome(),await i.fetchPaidHistory()}),(u,x)=>(s(),n("div",E,[x[1]||(x[1]=e("h1",{class:"text-3xl font-bold mb-6 text-center"},"Software Charge",-1)),c.value?(s(),n("div",J,"Loading...")):a.value?(s(),n("div",K,v(a.value),1)):(s(),n("div",O,[e("table",z,[x[0]||(x[0]=e("thead",null,[e("tr",{class:"bg-gray-200 *:px-2 *:py-1.5"},[e("th",{class:"border"},"Month"),e("th",{class:"border"},[f("Total "),e("span",{class:"hidden md:inline"},"Transaction")]),e("th",{class:"border"},[e("span",{class:"hidden md:inline"},"Software"),f(" Charge")]),e("th",{class:"border"},[f("Paid "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},[f("Due "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},"Action")])],-1)),e("tbody",null,[(s(!0),n(L,null,C(y(i).monthWiseTotalIncome,m=>(s(),M(q,{key:m.month,monthIncome:m,percentage:5},null,8,["monthIncome"]))),128))])])]))]))}};export{Q as default};
