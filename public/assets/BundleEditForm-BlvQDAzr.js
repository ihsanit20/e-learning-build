import{P as L,r,Q as i,I as R,x as v,z as s,A,H as d,C as u,M as F,U as B,D as T,a9 as w,F as j,G as z,L as H,Z as K,T as $,y as m,X as C}from"./vue-CAqJJQzZ.js";import{d as q,u as G}from"./index--DNSAfWm.js";import{_ as Q}from"./TextEditor-iSTvUU0S.js";import"./vendor-PJuFQbji.js";const X={class:"my-container"},Z={class:"card-bg p-4 md:p-8"},J={class:"flex flex-wrap justify-between mb-4"},O={class:"flex items-center flex-wrap gap-2 text-sm mb-4"},W={class:"border p-4 rounded-md grid sm:grid-cols-2 lg:grid-cols-3 gap-4"},Y={class:"border p-4 rounded-md grid grid-cols-2 gap-2 items-center"},ee={class:"flex items-start gap-2"},se=["onClick"],te={class:"space-x-1"},oe={class:"shrink-0 grow-0"},le={class:"block"},ae=["onUpdate:modelValue"],ue={class:"flex gap-4 justify-between"},ne=["disabled"],re={key:0,class:"message"},me={__name:"BundleEditForm",setup(ie){const S=L(),M=$(),_=q(),b=G(),V=S.params.id,n=r(""),c=r(""),l=r([]),f=r(""),p=r(""),U=async()=>{await _.fetchBundle(V);const t=_.bundle;t&&(n.value=t.title,c.value=t.description,l.value=t.bundle_courses.map(e=>({course_id:e.course_id,course_price:e.course_price??""})))},D=i(()=>b.courses.filter(t=>l.value.some(e=>parseInt(e.course_id)===parseInt(t.id))));function N(){var o;const t=parseInt(p.value);if(!t)return;const e=l.value.some(a=>parseInt(a.course_id)===t),x=(o=b.courses)==null?void 0:o.some(a=>parseInt(a.id)===t);!e&&x&&l.value.push({course_id:t,course_price:""}),p.value=""}function P(t){confirm("Are you sure to remove this course?")&&l.value.splice(t,1)}const E=async()=>{const t={title:n.value,description:c.value,bundle_courses:l.value};try{await _.updateBundle(V,t),f.value="Bundle updated successfully!",M.push("/management/bundle-list")}catch(e){console.error(e)}},g=i(()=>!!n.value),y=i(()=>l.value.length>=2),h=i(()=>l.value.length>=2&&l.value.every(t=>t.course_price!==""&&Number(t.course_price)>=0)),k=i(()=>g.value&&y.value&&h.value);return R(async()=>{await b.fetchCourses({price:"paid",status:"active",publish:"published"}),await U()}),(t,e)=>{const x=K("RouterLink");return m(),v("div",X,[s("div",Z,[s("div",J,[e[3]||(e[3]=s("h1",{class:"title-lg"},"Edit Bundle",-1)),s("div",O,[s("div",{class:d(g.value?"text-green-600":"text-gray-600")},u(g.value?"✅":"-")+" Bundle Title ",3),s("div",{class:d(y.value?"text-green-600":"text-gray-600")},u(y.value?"✅":"-")+" Minimum 2 courses ",3),s("div",{class:d(h.value?"text-green-600":"text-gray-600")},u(h.value?"✅":"-")+" Bundle Price ",3)])]),s("form",{onSubmit:F(E,["prevent"]),class:"space-y-4"},[B(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),placeholder:"Bundle Title",class:"input-1 w-full"},null,512),[[w,n.value]]),s("div",W,[s("div",Y,[B(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o),class:"input-1 text-center pb-1.5",placeholder:"Course ID"},null,512),[[w,p.value]]),s("button",{onClick:N,type:"button",class:"btn-1 py-2"},"+ Add")]),(m(!0),v(j,null,z(D.value,(o,a)=>(m(),v("div",{key:o.id,class:d(["border p-4 rounded-md space-y-2 text-center relative",{"col-start-1":!a}])},[s("div",ee,[s("i",{onClick:I=>P(a),class:"shrink-0 grow-0 fa fa-trash text-red-600 cursor-pointer"},null,8,se),s("div",te,[s("b",oe,u(o.id)+".",1),s("i",null,u(o.title),1)])]),s("div",null,"Course Price: "+u(o.price)+" TK",1),s("label",le,[e[4]||(e[4]=C(" Bundle Price ")),B(s("input",{type:"number","onUpdate:modelValue":I=>l.value[a].course_price=I,class:"input-1 max-w-24 py-1",min:"0",required:""},null,8,ae),[[w,l.value[a].course_price]]),e[5]||(e[5]=C(" TK "))])],2))),128))]),T(Q,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o),placeholder:"Description"},null,8,["modelValue"]),s("div",ue,[T(x,{to:"/management/bundle-list",class:"btn-contrast"},{default:H(()=>e[6]||(e[6]=[C("← Back")])),_:1}),s("button",{type:"submit",class:d(["btn-2",{"opacity-50 cursor-not-allowed":!k.value}]),disabled:!k.value}," Save Bundle ",10,ne)])],32),f.value?(m(),v("p",re,u(f.value),1)):A("",!0)])])}}};export{me as default};
