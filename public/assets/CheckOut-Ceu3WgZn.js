import{b as A,c as I,u as K,r,d as B,o as q,e as o,f as l,i as _,t as c,p as i,g as e,q as x,F as P,E as z,s as H,z as S,A as D,G as O,H as G,v as Y,R as J}from"./index-BedAWJhs.js";import{u as Q}from"./coupon-Dkkvvhr_.js";import{u as W}from"./purchase-BJJXQALE.js";const X="/assets/bkash_payment_logo-CHh0TPdw.png",Z={class:"my-container py-4"},ee={key:0,class:"space-y-4"},se=e("h1",{class:"title-xl text-center"},"Checkout Page",-1),te={key:0,class:"text-center text-green-600 bg-green-600/20 p-4 rounded font-bold text-xl md:text-2xl"},oe={class:"grid md:grid-cols-2 gap-4"},le={class:"card-bg p-4 flex gap-4"},ae=["src"],ne={class:"space-y-2"},ce={class:"title-xl"},re={class:"flex gap-4 justify-between"},ue={class:"font-bold text-sky-600"},ie={key:0},de={class:"font-bold text-sky-600"},pe={key:1,class:"bg-pink-50 px-3 rounded-full"},ve={class:"font-bold text-pink-600"},_e=e("hr",{class:"border-black"},null,-1),he={class:"flex justify-end gap-2 items-center mt-4"},ye=e("p",null,"You have already purchased this course.",-1),me={class:"card-bg p-4 space-y-3"},fe=e("h4",{class:"title-lg text-center"},"Payment Details",-1),xe={class:"space-y-1"},be={class:"flex justify-between"},ke=e("p",null,"Course Fee",-1),ge={class:"flex justify-between"},Ce=e("p",null,"Promo Discount",-1),we=e("hr",null,null,-1),Pe={class:"flex justify-between font-bold"},Se=e("p",null,"Total",-1),Ee=e("hr",{class:"border-black"},null,-1),Ue=e("p",{class:"title-lg text-center"},"Enter Coupon Code",-1),Fe={key:0,class:"flex justify-center items-center flex-wrap"},Te=e("span",{class:"text-green-700"}," ✓ Applied Code: ",-1),je={class:"border rounded px-2 pt-1.5 pb-0.5 mx-2"},Be={key:1,class:"flex gap-2"},De=["disabled"],Me={key:0,class:"animate-spin border size-4 rounded-full"},Ve={key:2,class:"error text-rose-600"},Ne=e("hr",{class:"border-black"},null,-1),Le={class:"flex items-center space-x-2 cursor-pointer"},Re=e("span",{class:"pt-1"},"Purchase for someone else",-1),$e={key:0,class:"mt-4 flex gap-2"},Ae={key:0,class:"flex justify-center items-center flex-wrap"},Ie=e("span",{class:"text-green-700"}," ✓",-1),Ke={class:"border rounded px-2 pt-1.5 pb-0.5 mx-2"},qe={class:"w-full flex items-center"},ze=e("span",{class:"input-1 max-w-max pl-3 pr-1 pt-2.5 pb-1.5 text-gray-600 bg-gray-200 rounded-r-none"}," +88 ",-1),He=["disabled"],Oe={key:0,class:"animate-spin border size-4 rounded-full"},Ge={key:3,class:"error text-rose-600"},Ye=e("hr",{class:"border-black"},null,-1),Je=e("p",{class:"title-lg text-center"},"Select payment method",-1),Qe={class:"mt-2"},We={class:"flex items-center space-x-4"},Xe=e("span",null,[e("img",{class:"w-52",src:X,alt:"Bkash Payment"})],-1),Ze={key:5,class:"mt-2 text-red-600 font-bold text-center text-xl"},es={key:1},as={__name:"CheckOut",setup(ss){const E=A(),M=I(),U=E.query.message,F=K(),b=W(),V=Q(),k=E.params.id,a=r(null),d=r(null),h=r(!1),g=r("bkash_payment"),C=r(""),u=r(null),p=r(E.query.for==="someone"),w=r(""),y=r(""),T=r(""),v=r(null),m=r(!1),j=B(()=>{var t;return(t=a.value)==null?void 0:t.is_purchased});q(async()=>{try{await F.fetchCourse(k),a.value=F.course}catch(t){d.value=t.message||"Failed to fetch course"}});const f=B(()=>{if(!a.value)return 0;let t=0;return u.value&&(u.value.discount_type==="percentage"?t=a.value.price*u.value.discount_value/100:t=u.value.discount_value),t}),N=async()=>{h.value=!0;try{const t=await V.fetchCouponByCode(C.value);if(console.log(t),!t)throw new Error("Invalid coupon code");u.value=t,d.value=null,console.log("Coupon applied:",u.value),h.value=!1}catch(t){d.value=t.message||"Invalid coupon code",console.error("Error applying coupon:",d.value),u.value=null,h.value=!1}C.value=""},L=async()=>{var t,n;if(!w.value){v.value="Please enter a phone number";return}m.value=!0;try{const s=await b.findNotEnrolledUserByPhone(k,w.value);if(console.log("User found:",s),!s)throw new Error("User not found");v.value=null,y.value=s.id,T.value=s.name,m.value=!1}catch(s){v.value=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||s.message||"User not found",console.error("Error searching user:",v.value),m.value=!1}},R=async()=>{var t,n;try{if(g.value==="bkash_payment"){const s=await b.createPayment(k,{coupon_code:(t=u.value)==null?void 0:t.code,user_id:p.value?y.value:null});console.log("Bkash payment response:",s),window.location=(n=s==null?void 0:s.data)==null?void 0:n.bkashURL}else g.value==="bank_transfer"&&(alert("Bank Transfer selected. Checkout completed successfully!"),M.push("/my/course"))}catch(s){d.value=s.message||"Failed to initiate payment",console.error("Error during checkout:",d.value)}},$=t=>Y(new Date(t),"dd-MMM-yyyy");return(t,n)=>(o(),l("div",Z,[a.value?(o(),l("div",ee,[se,_(U)?(o(),l("div",te,c(_(U)),1)):i("",!0),e("div",oe,[e("div",le,[e("div",null,[e("img",{src:a.value.thumbnail,alt:"",class:"w-full aspect-video object-cover"},null,8,ae)]),e("div",ne,[e("h1",ce,c(a.value.title),1),e("div",re,[e("p",null,[x(" Course Fee: "),e("span",ue,c(a.value.price>0?`${a.value.price} TK`:"Free"),1)]),a.value.course_type==="Live Course"?(o(),l("p",ie,[x(" Start Date: "),e("span",de,c($(a.value.start_date)),1)])):(o(),l("p",pe,[e("span",ve,c(a.value.course_type),1)]))])]),j.value?(o(),l(P,{key:0},[_e,e("div",he,[ye,z(_(J),{to:`/my/course/${_(k)}`,class:"btn-2"},{default:H(()=>[x(" Start Learning ")]),_:1},8,["to"])])],64)):i("",!0)]),e("div",me,[fe,e("div",xe,[e("div",be,[ke,e("p",null,c(a.value.price>0?`${a.value.price} TK`:"Free"),1)]),e("div",ge,[Ce,e("p",null,c(f.value),1)]),we,e("div",Pe,[Se,e("p",null,c(a.value.price-f.value)+" TK",1)])]),Ee,Ue,u.value?(o(),l("div",Fe,[Te,e("b",je,c(u.value.code),1),e("i",{onClick:n[0]||(n[0]=s=>u.value=null),class:"fas fa-trash text-red-600 ml-2 cursor-pointer"})])):(o(),l("div",Be,[S(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=s=>C.value=s),class:"input-1",placeholder:"Enter coupon code"},null,512),[[D,C.value]]),e("button",{onClick:N,class:"btn-2",disabled:h.value},[x(" Apply "),h.value?(o(),l("span",Me,".")):i("",!0)],8,De)])),d.value?(o(),l("div",Ve,c(d.value),1)):i("",!0),Ne,e("div",null,[e("label",Le,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=s=>p.value=s)},null,512),[[O,p.value]]),Re]),p.value?(o(),l("div",$e,[y.value?(o(),l("div",Ae,[Ie,e("b",Ke,c(T.value),1),e("i",{onClick:n[3]||(n[3]=s=>y.value=null),class:"fas fa-trash text-red-600 ml-2 cursor-pointer"})])):(o(),l(P,{key:1},[e("div",qe,[ze,S(e("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=s=>w.value=s),class:"input-1 rounded-l-none px-1 pt-2.5 pb-1.5",placeholder:"Enter User Phone"},null,512),[[D,w.value]])]),e("button",{type:"button",onClick:L,class:"btn-2",disabled:m.value},[x(" Search "),m.value?(o(),l("span",Oe,".")):i("",!0)],8,He)],64))])):i("",!0)]),v.value?(o(),l("div",Ge,c(v.value),1)):i("",!0),!p.value&&!j.value||p.value&&y.value?(o(),l(P,{key:4},[Ye,a.value.price-f.value>0?(o(),l(P,{key:0},[Je,e("div",Qe,[e("label",We,[S(e("input",{type:"radio","onUpdate:modelValue":n[5]||(n[5]=s=>g.value=s),value:"bkash_payment"},null,512),[[G,g.value]]),Xe])])],64)):i("",!0),e("button",{class:"btn-2 mt-4",onClick:R},c(a.value.price-f.value>0?`Pay Now (${a.value.price-f.value} TK)`:"Checkout (Fee)"),1)],64)):i("",!0),_(b).error?(o(),l("div",Ze,c(_(b).error),1)):i("",!0)])])])):(o(),l("div",es,"Loading..."))]))}};export{as as default};
