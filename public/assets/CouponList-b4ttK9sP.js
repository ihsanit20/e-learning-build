import{u as j}from"./coupon-49yTxPJF.js";import{r as a,I,x as i,y as o,z as e,M as B,A as k,X as m,U as c,ag as T,F as S,G as F,C as r,B as q,a9 as D,a2 as L,ac as h,O as E,H as z}from"./vue-CcEtAIOs.js";import{u as N,f as G}from"./index-D6NlM3We.js";import{u as H}from"./user-CQZ1uaZB.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-PJuFQbji.js";const P={class:"modal"},R={class:"max-w-4-xl bg-white p-4 rounded-lg space-y-2"},O={class:"col-start-1"},X={key:0},J=["value"],Q={class:"col-start-1"},W={key:1},Y={class:"flex items-center"},Z={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ee={class:"col-start-1 col-span-full"},te=["value"],se={class:"col-start-1"},le={class:"flex items-center"},oe={class:"w-10 h-full shrink-0 grow-0 flex justify-center items-center text-xl font-bold"},ne={class:"flex gap-4 col-span-full"},ae={__name:"AddCouponModal",emits:["close"],setup(M,{emit:V}){const v=V,f=j(),w=H(),y=N(),x=a(""),n=a("general"),b=a(""),U=a(""),p=a("percentage"),g=a(0),C=a(0),_=a(""),$=a(""),A=async()=>{await f.createCoupon({code:x.value,code_type:n.value,affiliate_user_id:b.value,course_id:U.value,discount_type:p.value,discount_value:C.value,commission_value:g.value,valid_from:_.value,valid_until:$.value}),v("close")};return I(async()=>{await w.fetchUsers({affiliate_status:"Active"}),await y.fetchCourses({price:"paid",fields:["id","title","price","category_id"]})}),(d,t)=>(o(),i("div",P,[e("div",R,[t[25]||(t[25]=e("h2",{class:"text-xl font-semibold"},"Add Coupon",-1)),t[26]||(t[26]=e("hr",{class:"col-span-full"},null,-1)),e("form",{onSubmit:B(A,["prevent"]),class:"grid md:grid-cols-2 gap-4"},[e("label",O,[t[11]||(t[11]=m(" Coupon Type ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s)},t[10]||(t[10]=[e("option",{value:"general"},"General",-1),e("option",{value:"affiliate"},"Affiliate",-1)]),512),[[T,n.value]])]),n.value==="affiliate"?(o(),i("label",X,[t[13]||(t[13]=m(" User ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),required:""},[t[12]||(t[12]=e("option",{value:""},"-- Select User --",-1)),(o(!0),i(S,null,F(q(w).users,s=>(o(),i("option",{key:s.id,value:s.id},r(`[${s.phone}] ${s.name}`),9,J))),128))],512),[[T,b.value]])])):k("",!0),e("label",Q,[t[14]||(t[14]=m(" Coupon code ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),placeholder:"Coupon code",required:""},null,512),[[D,x.value]])]),n.value==="affiliate"?(o(),i("label",W,[t[15]||(t[15]=m(" Commission value ")),e("div",Y,[c(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[3]||(t[3]=s=>g.value=s),type:"number",required:""},null,512),[[D,g.value]]),e("div",Z,r(p.value==="percentage"?"%":"TK"),1)])])):k("",!0),e("label",ee,[t[17]||(t[17]=m(" Course: ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s)},[t[16]||(t[16]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,F(q(y).courses,s=>(o(),i(S,{key:s.id},[s.price>0?(o(),i("option",{key:0,value:s.id},r(`[${s.id}] ${s.title}`),9,te)):k("",!0)],64))),128))],512),[[T,U.value]])]),e("label",se,[t[19]||(t[19]=m(" Discount Type ")),c(e("select",{class:"input-1","onUpdate:modelValue":t[5]||(t[5]=s=>p.value=s)},t[18]||(t[18]=[e("option",{value:"percentage"},"Percentage",-1),e("option",{value:"fixed"},"Fixed Amount",-1)]),512),[[T,p.value]])]),e("label",null,[t[20]||(t[20]=m(" Discount Amount ")),e("div",le,[c(e("input",{class:"input-1 text-right","onUpdate:modelValue":t[6]||(t[6]=s=>C.value=s),placeholder:"Discount value",type:"number",required:""},null,512),[[D,C.value]]),e("div",oe,r(p.value==="percentage"?"%":"TK"),1)])]),e("label",null,[t[21]||(t[21]=m(" Valid From ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[7]||(t[7]=s=>_.value=s),placeholder:"Valid from",type:"date",required:""},null,512),[[D,_.value]])]),e("label",null,[t[22]||(t[22]=m(" Valid Until ")),c(e("input",{class:"input-1","onUpdate:modelValue":t[8]||(t[8]=s=>$.value=s),placeholder:"Valid until",type:"date",required:""},null,512),[[D,$.value]])]),t[24]||(t[24]=e("hr",{class:"col-span-full"},null,-1)),e("div",ne,[t[23]||(t[23]=e("button",{type:"submit",class:"btn-2"},"Add",-1)),e("button",{type:"button",onClick:t[9]||(t[9]=s=>v("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},ie={class:"modal"},ue={class:"modal-content space-y-2"},de={class:"flex gap-4"},re={__name:"DeleteCouponModal",props:["coupon"],emits:["close"],setup(M,{emit:V}){const v=M,f=V,w=j(),y=async()=>{await w.deleteCoupon(v.coupon.id),f("close")};return(x,n)=>(o(),i("div",ie,[e("div",ue,[n[3]||(n[3]=e("h2",null,"Delete Coupon",-1)),e("p",null,[n[1]||(n[1]=m("Are you sure you want to delete the coupon ")),e("strong",null,r(M.coupon.code),1),n[2]||(n[2]=m("?"))]),e("div",de,[e("button",{type:"button",class:"btn-2",onClick:y},"Delete"),e("button",{type:"button",onClick:n[0]||(n[0]=b=>f("close")),class:"btn-contrast"},"Cancel")])])]))}},pe={class:"modal"},ce={class:"max-w-2xl z-50 card-bg p-4 md:p-8 space-y-2"},ve={class:"flex flex-wrap justify-between items-center gap-2"},me={class:"border rounded-lg px-3 pt-2 pb-1 font-semibold text-black"},fe={class:"capitalize border rounded-lg px-3 pt-2 pb-1"},ye={key:0,class:"border rounded-lg px-3 pt-2 pb-1"},be={class:"col-start-1 col-span-full block"},_e=["value"],xe={class:"grid md:grid-cols-4 gap-3 items-end"},ge={class:"md:col-span-3 border pt-3 pb-2 rounded-lg px-2"},Ce={class:"flex justify-center items-center gap-3"},$e={class:"flex items-center cursor-pointer"},ke={class:"flex items-center cursor-pointer"},Ve={class:"relative"},we={class:"absolute top-2 right-3"},De={key:0},Ue={class:"relative"},Me={class:"absolute top-2 right-3"},Ae={class:"grid md:grid-cols-2 gap-3"},Se={class:"flex justify-center gap-4"},Te={__name:"EditCouponModal",props:["coupon"],emits:["close"],setup(M,{emit:V}){const v=M,f=V,w=j(),y=N(),x=a(""),n=a(""),b=a("general"),U=a(""),p=a("percentage"),g=a(0),C=a(0),_=a(""),$=a(""),A=s=>G(new Date(s),"yyyy-MM-dd"),d=s=>{x.value=s.code,n.value=s.course_id||"",b.value=s.code_type,U.value=s.affiliate_user_id,p.value=s.discount_type,g.value=s.discount_value,C.value=s.commission_value,_.value=A(s.valid_from),$.value=A(s.valid_until)};L(v.coupon,s=>{d(s)}),I(async()=>{await y.fetchCourses({price:"paid",fields:["id","title","price","category_id"]}),v.coupon&&d(v.coupon)});const t=async()=>{await w.updateCoupon(v.coupon.id,{course_id:n.value,discount_type:p.value,discount_value:g.value,commission_value:C.value,valid_from:_.value,valid_until:$.value}),f("close")};return(s,l)=>(o(),i("div",pe,[e("div",ce,[l[19]||(l[19]=e("h2",{class:"title-lg"},"Edit Coupon",-1)),e("form",{onSubmit:B(t,["prevent"]),class:"space-y-4"},[e("div",ve,[e("p",me,r(x.value),1),e("p",fe,"Type: "+r(b.value),1),b.value==="affiliate"?(o(),i("p",ye," User ID: "+r(U.value),1)):k("",!0)]),e("label",be,[l[9]||(l[9]=m(" Course: ")),c(e("select",{class:"input-1","onUpdate:modelValue":l[0]||(l[0]=u=>n.value=u)},[l[8]||(l[8]=e("option",{value:""},"[*] All Course",-1)),(o(!0),i(S,null,F(q(y).courses,u=>(o(),i(S,{key:u.id},[u.price>0?(o(),i("option",{key:0,value:u.id},r(`[${u.id}] ${u.title}`),9,_e)):k("",!0)],64))),128))],512),[[T,n.value]])]),e("div",xe,[e("div",ge,[l[13]||(l[13]=e("p",{class:"md:hidden text-gray-500"},"Discount type:",-1)),e("div",Ce,[l[12]||(l[12]=e("p",{class:"hidden md:block text-gray-500"},"Discount type:",-1)),e("label",$e,[c(e("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=u=>p.value=u),value:"percentage",class:"form-radio"},null,512),[[h,p.value]]),l[10]||(l[10]=e("span",{class:"ml-2"},"Percentage",-1))]),e("label",ke,[c(e("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=u=>p.value=u),value:"fixed",class:"form-radio"},null,512),[[h,p.value]]),l[11]||(l[11]=e("span",{class:"ml-2"},"Fixed Amount",-1))])])]),e("div",null,[l[14]||(l[14]=e("p",null,"Discount value",-1)),e("div",Ve,[c(e("input",{class:"input-1","onUpdate:modelValue":l[3]||(l[3]=u=>g.value=u),placeholder:"Discount value",type:"number",required:""},null,512),[[D,g.value]]),e("span",we,r(p.value==="percentage"?"%":"Tk"),1)])]),b.value==="affiliate"?(o(),i("div",De,[l[15]||(l[15]=e("p",null,"Commission value",-1)),e("div",Ue,[c(e("input",{class:"input-1","onUpdate:modelValue":l[4]||(l[4]=u=>C.value=u),placeholder:"Commission value",type:"number",required:""},null,512),[[D,C.value]]),e("span",Me,r(p.value==="percentage"?"%":"Tk"),1)])])):k("",!0)]),e("div",Ae,[e("div",null,[l[16]||(l[16]=e("p",null,"Valid from",-1)),c(e("input",{class:"input-1","onUpdate:modelValue":l[5]||(l[5]=u=>_.value=u),placeholder:"Valid from",type:"date",required:""},null,512),[[D,_.value]])]),e("div",null,[l[17]||(l[17]=e("p",null,"Valid to",-1)),c(e("input",{class:"input-1","onUpdate:modelValue":l[6]||(l[6]=u=>$.value=u),placeholder:"Valid until",type:"date",required:""},null,512),[[D,$.value]])])]),e("div",Se,[l[18]||(l[18]=e("button",{type:"submit",class:"btn-2"},"Save",-1)),e("button",{type:"button",onClick:l[7]||(l[7]=u=>f("close")),class:"btn-contrast"},"Cancel")])],32)])]))}},qe=K(Te,[["__scopeId","data-v-326e68dc"]]),Fe={class:"my-container space-y-2"},je={class:"flex justify-between"},Ee={class:"flex items-center gap-4"},ze={class:"card-bg p-2"},Ie={key:0,class:"flex justify-center items-center"},he={key:1},Be={key:0,class:"table-auto w-full"},Ne={class:""},Ge={class:"text-center max-w-xs"},Le={class:"text-center"},He={class:"text-center"},Ke={key:0},Pe={key:1},Re={class:""},Oe={class:""},Xe={class:""},Je={class:"flex justify-center gap-2"},Qe=["onClick"],We={key:1,class:"text-red-500"},ot={__name:"CouponList",setup(M){const V=j(),v=a(!1),f=a(!1),w=a(!1),y=a(null),x=a(!0),n=a("general"),b=()=>v.value=!0,U=()=>v.value=!1,p=d=>{y.value=d,f.value=!0},g=()=>f.value=!1,C=()=>w.value=!1,_=d=>G(new Date(d),"dd-MMM-yyyy"),$=d=>{if(!(d!=null&&d.valid_from)||!(d!=null&&d.valid_until))return!1;const t=new Date,s=new Date(d.valid_from),l=new Date(d.valid_until);return l.setHours(23,59,59,999),t>=s&&t<=l},A=d=>({"bg-sky-700/40":d.highlight,"text-gray-400":!$(d)});return I(async()=>{try{await V.fetchCoupons()}finally{x.value=!1}}),(d,t)=>(o(),i("div",Fe,[e("div",je,[e("div",Ee,[e("button",{class:z(n.value==="general"?"btn-2":"btn-1"),type:"button",onClick:t[0]||(t[0]=s=>n.value="general")}," General Coupons ",2),e("button",{class:z(n.value==="affiliate"?"btn-2":"btn-1"),type:"button",onClick:t[1]||(t[1]=s=>n.value="affiliate")}," Affiliate Coupons ",2)]),e("button",{class:"btn-2",onClick:b},"Add Coupon")]),e("div",ze,[x.value?(o(),i("div",Ie,t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-gray-900"},null,-1)]))):(o(),i("div",he,[q(V).coupons.length?(o(),i("table",Be,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"text-left *:px-3 *:py-1"},[e("th",{class:""},"Code"),e("th",{class:"text-center"},"Course"),e("th",{class:"text-center"},"Discount Type"),e("th",{class:"text-center"},"Discount Value"),e("th",{class:""},"Valid From"),e("th",{class:""},"Valid Until"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[(o(!0),i(S,null,F(q(V).coupons.filter(s=>s.code_type===n.value),s=>{var l;return o(),i("tr",{key:s.id,class:z(["border-t *:px-3 *:py-0.5 text-sm hover:bg-sky-700/30",A(s)])},[e("td",Ne,r(s.code),1),e("td",Ge," ["+r(s.course_id||"*")+"] "+r(((l=s==null?void 0:s.course)==null?void 0:l.title)||"All Course"),1),e("td",Le,r(s.discount_type),1),e("td",He,[m(r(s.discount_value)+" ",1),s.discount_type==="percentage"?(o(),i("span",Ke,"%")):(o(),i("span",Pe,"Tk"))]),e("td",Re,r(_(s.valid_from)),1),e("td",Oe,r(_(s.valid_until)),1),e("td",Xe,[e("div",Je,[e("button",{onClick:u=>p(s),class:"btn-1 px-4 pt-1 py-0 text-xs"}," Edit ",8,Qe),k("",!0)])])],2)}),128))])])):(o(),i("p",We,"No coupons found"))]))]),v.value?(o(),E(ae,{key:0,class:"z-40",onClose:U})):k("",!0),f.value?(o(),E(qe,{key:1,class:"z-40",coupon:y.value,onClose:g},null,8,["coupon"])):k("",!0),w.value?(o(),E(re,{key:2,class:"z-40",coupon:y.value,onClose:C},null,8,["coupon"])):k("",!0)]))}};export{ot as default};
