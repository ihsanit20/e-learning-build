import{P as D,r as a,I,Q as E,x as l,z as s,A as u,B as k,C as r,D as M,X as _,L as K,Z as A,U as C,ab as $,F as B,a9 as q,ac as z,T as O,y as o}from"./vue-CcEtAIOs.js";import{_ as G}from"./bkash_payment_logo-S19rnIIS.js";import{u as Q,_ as X}from"./index-QKDGB8Qs.js";import{u as Y}from"./purchase-D6C9oSE2.js";import"./vendor-PJuFQbji.js";const Z={class:"max-w-4xl mx-auto py-4"},H={key:0,class:"space-y-4"},J={key:0,class:"text-center text-green-600 bg-green-600/20 p-4 rounded font-bold text-xl md:text-2xl"},W={class:"grid gap-4 md:grid-cols-2"},ee={class:"card-bg p-4 space-y-2"},se={class:"space-y-2"},te={class:"flex justify-between"},le={class:"flex justify-between"},oe={class:"flex justify-between font-bold"},ne={key:0,class:"flex justify-center items-center flex-col gap-4"},re={class:"text-orange-500 text-center"},ae={key:1,class:"space-y-4"},ue={key:0,class:"border-black"},de={key:1,class:"error text-rose-600"},ie={class:"flex items-center justify-center space-x-2 cursor-pointer"},ce={key:0,class:"mt-4 flex gap-2"},pe={key:0,class:"flex justify-center items-center w-full"},ve={class:"border rounded px-2 pt-1.5 pb-0.5 mx-2 text-xs md:text-sm line-clamp-1"},me={class:"w-full flex items-center"},ye=["disabled"],be={key:0,class:"animate-spin border size-4 rounded-full"},fe={key:2,class:"error text-rose-600"},xe={class:"mt-2"},he={class:"flex justify-center items-center space-x-4"},ke={class:"flex justify-center items-center"},_e={key:4,class:"mt-2 text-red-600 font-bold text-center text-xl"},ge={key:1,class:"flex justify-center items-center p-4"},Se={__name:"BundleCourseCheckOut",setup(we){const g=D(),V=O(),P=g.query.message,U=Q(),x=Y(),w=g.params.bundleId,d=a(null),i=a(null),h=a("bkash_payment"),c=a(g.query.for==="someone"),m=a(""),y=a(""),N=a(""),p=a(null),b=a(!1);I(async()=>{try{await U.fetchBundle(w),d.value=U.bundle}catch(n){i.value=n.message||"Failed to fetch bundle"}});const L=async()=>{var n,e;if(!m.value){p.value="Please enter a phone number";return}b.value=!0;try{const t=await x.findNotBundleEnrolledUserByPhone(w,m.value);if(console.log("User found:",t),!t)throw new Error("User not found");p.value=null,y.value=t.id,N.value=t.name,b.value=!1}catch(t){p.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||t.message||"User not found",console.error("Error searching user:",p.value),b.value=!1}},R=async()=>{var n;try{if(h.value==="bkash_payment"){const e=await x.createBundlePayment(w,{user_id:c.value?y.value:null});console.log("Bkash payment response:",e),window.location=(n=e==null?void 0:e.data)==null?void 0:n.bkashURL}else h.value==="bank_transfer"&&(alert("Bank Transfer selected. Checkout completed successfully!"),V.push("/my/bundle"))}catch(e){i.value=e.message||"Failed to initiate payment",console.error("Error during checkout:",i.value)}},S=E(()=>d.value.bundle_courses.reduce((n,e)=>{var t;return n+Number(((t=e.course)==null?void 0:t.price)||0)},0)),f=E(()=>{const n=d.value.bundle_courses.reduce((e,t)=>e+Number(t.course_price||0),0);return Number(n).toFixed()});return(n,e)=>{var j,T,F;const t=A("RouterLink");return o(),l("div",Z,[d.value?(o(),l("div",H,[e[21]||(e[21]=s("h1",{class:"title-xl text-center"},"Checkout Page",-1)),k(P)?(o(),l("div",J,r(k(P)),1)):u("",!0),s("div",W,[s("div",null,[M(X,{bundle:d.value,showSlotButton:!1},null,8,["bundle"])]),s("div",null,[s("div",ee,[e[20]||(e[20]=s("h4",{class:"title-lg text-center"},"Payment Details",-1)),s("div",se,[s("div",te,[e[4]||(e[4]=s("p",null,"Course Fee",-1)),s("p",null,r(S.value)+" TK",1)]),s("div",le,[e[5]||(e[5]=s("p",null,"Bundle Discount",-1)),s("p",null,r(S.value-f.value)+" TK",1)]),e[7]||(e[7]=s("hr",null,null,-1)),s("div",oe,[e[6]||(e[6]=s("p",null,"Total",-1)),s("p",null,r(f.value)+" TK",1)])]),(j=d.value.purchased_course_ids)!=null&&j.length?(o(),l("div",ne,[e[10]||(e[10]=s("hr",{class:"w-full border-black"},null,-1)),s("p",re,[e[8]||(e[8]=_(" You have already purchased ")),s("b",null,r((T=d.value.purchased_course_ids)==null?void 0:T.length),1),_(" course"+r(((F=d.value.purchased_course_ids)==null?void 0:F.length)>1?"s":"")+' from this bundle. Check the "My Courses" page for detail. ',1)]),M(t,{to:"/my/course",class:"btn-2"},{default:K(()=>e[9]||(e[9]=[_(" Go to My Course ")])),_:1})])):(o(),l("div",ae,[i.value?(o(),l("hr",ue)):u("",!0),i.value?(o(),l("div",de,r(i.value),1)):u("",!0),e[18]||(e[18]=s("hr",{class:"border-black"},null,-1)),s("div",null,[s("label",ie,[C(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=v=>c.value=v)},null,512),[[$,c.value]]),e[11]||(e[11]=s("span",{class:"pt-1"},"Purchase for someone else",-1))]),c.value?(o(),l("div",ce,[y.value?(o(),l("div",pe,[e[12]||(e[12]=s("span",{class:"text-green-700 font-extrabold"}," âœ“",-1)),s("b",ve," ("+r(m.value)+") "+r(N.value),1),s("i",{onClick:e[1]||(e[1]=v=>y.value=null),class:"fas fa-trash text-red-600 ml-2 cursor-pointer"})])):(o(),l(B,{key:1},[s("div",me,[e[13]||(e[13]=s("span",{class:"input-1 max-w-max pl-3 pr-1 pt-2.5 pb-1.5 text-gray-600 bg-gray-200 rounded-r-none"}," +88 ",-1)),C(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=v=>m.value=v),class:"input-1 rounded-l-none px-1 pt-2.5 pb-1.5",placeholder:"Enter User Phone"},null,512),[[q,m.value]])]),s("button",{type:"button",onClick:L,class:"btn-2",disabled:b.value},[e[14]||(e[14]=_(" Search ")),b.value?(o(),l("span",be," . ")):u("",!0)],8,ye)],64))])):u("",!0)]),p.value?(o(),l("div",fe,r(p.value),1)):u("",!0),e[19]||(e[19]=s("hr",{class:"border-black mt-3"},null,-1)),!c.value||c.value&&y.value?(o(),l(B,{key:3},[f.value>0?(o(),l(B,{key:0},[e[16]||(e[16]=s("p",{class:"title-lg text-center"},"Select payment method",-1)),s("div",xe,[s("label",he,[C(s("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=v=>h.value=v),value:"bkash_payment"},null,512),[[z,h.value]]),e[15]||(e[15]=s("span",null,[s("img",{class:"w-52",src:G,alt:"Bkash Payment"})],-1))])])],64)):u("",!0),e[17]||(e[17]=s("hr",{class:"border-black"},null,-1)),s("div",ke,[s("button",{class:"btn-2",onClick:R},r(f.value>0?`Pay Now (${f.value} TK)`:"Checkout (Fee)"),1)])],64)):u("",!0),k(x).error?(o(),l("div",_e,r(k(x).error),1)):u("",!0)]))])])])])):(o(),l("div",ge,"Loading..."))])}}};export{Se as default};
