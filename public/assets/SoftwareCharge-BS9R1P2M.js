import{J as T,r as w,K as L,ac as $,c as _,d as n,i as s,e,t as v,q as f,p as b,g as y,F as k,f as C,o as S,j as M}from"./index-B4Mp3J9K.js";const I=T("software-charge",()=>{const l=w(null),d=w([]),a=w([]),c=w(!1),m=o=>{const[u,r]=o.split("-").map(Number);return`${o}-${new Date(u,r,0).getDate()}`};return{error:l,isLoaded:c,payments:d,monthWiseTotalIncome:a,fetchMonthlyTotalIncome:async o=>{var r,i;const u={from:`${o}-01`,to:m(o)};try{const{data:g}=await L.get("/total-income",{params:u});return Number((g==null?void 0:g.total_income)??0).toFixed(2)}catch(g){throw l.value=((i=(r=g==null?void 0:g.response)==null?void 0:r.data)==null?void 0:i.message)??"An error occurred",l.value}},fetchMonthWiseTotalIncome:async()=>{var o,u;try{const{data:r}=await L.get("/month-wise-total-income");a.value=r}catch(r){throw l.value=((u=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:u.message)??"An error occurred",l.value}},fetchPaidHistory:async()=>{var u,r;const o="https://ihsanit.com";try{const{data:i}=await $.get(`${o}/api/software-charges/paid/history`,{headers:{"Content-Type":"application/json"}});return c.value=!0,d.value=i,i}catch(i){throw l.value=((r=(u=i==null?void 0:i.response)==null?void 0:u.data)==null?void 0:r.message)??"An error occurred",l.value}},paymentSoftwareCharge:async(o,u)=>{const i=`https://ihsanit.com/software-charges/payment/${o}/${u}`;return console.log(i),window.location=i}}}),j={class:"hover:bg-sky-700/15 *:px-1 *:py-1 *:border *:md:px-4 *:md:py-2"},P={class:"w-full flex gap-1 justify-between"},A={class:"w-full flex gap-1 justify-between"},D={key:0,class:"text-center animate-pulse"},N={key:1,class:"w-full flex gap-1 justify-between"},F={key:0,class:"text-center animate-pulse"},R={key:1,class:"w-full flex gap-1 justify-between"},U={key:2,class:"px-1.5 md:px-2.5 py-px rounded-xl border border-green-400 bg-green-100 text-green-600 font-mono text-xs md:text-sm"},W={key:0,class:"text-center animate-pulse"},B={key:1,class:"flex justify-center items-center gap-4"},H={key:2,class:"flex justify-center items-center gap-2 text-xs md:text-sm font-mono"},V={class:"inline-flex items-center gap-1 pt-px"},q={__name:"MonthlyTableRow",props:["monthIncome","percentage"],setup(l){const d=l,a=I(),c=_(()=>(d.monthIncome.total_income*d.percentage*.01).toFixed(0)),m=_(()=>{var t;return((t=a.payments)==null?void 0:t.filter(p=>p.month===d.monthIncome.month)).reduce((p,o)=>p+Number(o.paid_amount),0).toFixed(0)}),x=_(()=>{var h;return(h=a.payments)==null?void 0:h.filter(t=>t.month===d.monthIncome.month).map(t=>t.trx_id)});return(h,t)=>(s(),n("tr",j,[e("td",null,v(new Date(l.monthIncome.month+"-01").toLocaleString("default",{month:"short",year:"numeric"}).toUpperCase()),1),e("td",null,[e("div",P,[t[1]||(t[1]=e("span",null,"৳",-1)),f(" "+v(l.monthIncome.total_income),1)])]),e("td",null,[e("div",A,[t[2]||(t[2]=e("span",null,"৳",-1)),f(" "+v(c.value),1)])]),e("td",null,[y(a).isLoaded?b("",!0):(s(),n("div",D,"Loading...")),y(a).isLoaded&&m.value>0?(s(),n("div",N,[t[3]||(t[3]=e("span",null,"৳",-1)),f(" "+v(m.value),1)])):b("",!0)]),e("td",null,[y(a).isLoaded?c.value-m.value>0?(s(),n("div",R,[t[4]||(t[4]=e("span",null,"৳",-1)),f(" "+v((c.value-m.value).toFixed(0)),1)])):c.value>0?(s(),n("span",U," Paid ")):b("",!0):(s(),n("div",F,"Loading..."))]),e("td",null,[y(a).isLoaded?b("",!0):(s(),n("div",W,"Loading...")),y(a).isLoaded&&c.value-m.value>0?(s(),n("div",B,[e("button",{onClick:t[0]||(t[0]=p=>y(a).paymentSoftwareCharge(l.monthIncome.month,c.value-m.value)),class:"btn-2 px-2.5 pt-1 pb-0.5 text-xs md:text-sm"}," Pay Charge ")])):y(a).isLoaded&&c.value>0?(s(),n("div",H,[e("span",V,[t[5]||(t[5]=e("span",{class:"text-gray-400"},"TrxID:",-1)),(s(!0),n(k,null,C(x.value,p=>(s(),n("span",{key:p},v(p),1))),128))])])):b("",!0)])]))}},E={class:"my-container space-y-4"},J={key:0,class:"text-center mt-2"},K={key:1,class:"text-red-500 text-center mb-4"},O={key:2,class:"overflow-x-auto"},z={class:"w-full table table-auto text-center text-xs md:text-base"},Q={__name:"SoftwareCharge",setup(l){const d=I(),a=w(null),c=w(!1);return S(async()=>{await d.fetchMonthWiseTotalIncome(),await d.fetchPaidHistory()}),(m,x)=>(s(),n("div",E,[x[1]||(x[1]=e("h1",{class:"text-3xl font-bold mb-6 text-center"},"Software Charge",-1)),c.value?(s(),n("div",J,"Loading...")):a.value?(s(),n("div",K,v(a.value),1)):(s(),n("div",O,[e("table",z,[x[0]||(x[0]=e("thead",null,[e("tr",{class:"bg-gray-200 *:px-2 *:py-1.5"},[e("th",{class:"border"},"Month"),e("th",{class:"border"},[f("Total "),e("span",{class:"hidden md:inline"},"Transaction")]),e("th",{class:"border"},[e("span",{class:"hidden md:inline"},"Software"),f(" Charge")]),e("th",{class:"border"},[f("Paid "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},[f("Due "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},"Action")])],-1)),e("tbody",null,[(s(!0),n(k,null,C(y(d).monthWiseTotalIncome,h=>(s(),M(q,{key:h.month,monthIncome:h,percentage:5},null,8,["monthIncome"]))),128))])])]))]))}};export{Q as default};
