import{E as V,G as M,b as D,c as F,k as H,u as R,l as U,r as f,o as G,d as b,e as l,f as c,t as i,g as e,H as O,F as $,h as P,p as I,n as x,x as Y}from"./index-h_FQe1qy.js";const q=V("courseProgress",{state:()=>({userId:null}),actions:{async completeLecture(u,p,a){try{return(await M.post(`/lectures/${p}/complete`,{course_id:u,is_completed:a})).data}catch(_){throw console.error("Error completing lecture:",_),_}},async getLectureCompletionStatus(u,p){try{return(await M.get(`/users/${u}/lectures/${p}/completion`)).data.is_completed}catch(a){throw console.error("Error fetching lecture completion status:",a),a}},setUserId(u){this.userId=u}}}),J={class:"my-container py-4"},K={key:0,class:"error"},Q={key:1,class:"grid md:grid-cols-3 gap-4"},T={class:"md:col-span-2 space-y-4"},W={class:"title-xl"},X=e("hr",{class:"my-2"},null,-1),Z={class:"relative pt-1"},ee={class:"flex mb-2 items-center justify-between"},se=e("div",null,[e("span",null,"Course Progress")],-1),te={class:"text-right"},oe={class:"text-xs font-semibold inline-block text-sky-600"},le={class:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-sky-200"},ce=e("h2",{class:"title-lg"},"Modules",-1),re={class:"space-y-4"},ne=["onClick"],ie={class:"text-center border-2 rounded-md p-1.5"},ae=e("div",{class:"text-xs md:text-sm"},"Module",-1),de={class:"flex-1"},ue={class:"line-clamp-1"},pe={key:0},_e={class:""},he=["onClick"],ve={class:"flex flex-col items-center justify-center border rounded-md p-2 gap-1"},me={class:"text-xs"},fe={key:0},ye={key:1},xe={class:"flex-1"},ge={class:"text-gray-500 text-xs line-clamp-1"},ke={class:"flex items-center text-sm pt-2"},be=["id","checked","onChange","disabled"],we=["for"],Ce={key:2},Le={key:3,class:"fixed inset-0 flex items-center justify-center z-50"},Se=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75"},null,-1),Me={class:"card-bg items-center justify-center p-6 md:p-8 overflow-hidden transform transition-all sm:max-w-lg sm:w-full text-center mx-2"},$e=e("h3",{class:"title-lg",id:"modal-title"},"Confirm Lecture Completion",-1),Pe={class:""},Ie={class:"text-red-500"},je={class:"flex gap-4"},ze={__name:"MyCourseDetails",setup(u){const p=D(),a=F(),_=H(),w=R(),h=q(),C=U(),g=p.params.id,n=f(null),k=f(null),v=f([]),y=f(!1),m=f(null);G(async()=>{try{await w.fetchPurchasedCourse(g),n.value=w.course;const s=_.user.id;h.userId||h.setUserId(s);for(const t of n.value.modules)for(const d of t.lectures)d.is_completed=await h.getLectureCompletionStatus(s,d.id)}catch(s){k.value=s.message||"An error occurred",s.response&&s.response.status===403&&a.push("/")}});const j=s=>{const t=v.value.indexOf(s);t===-1?v.value.push(s):v.value.splice(t,1)},E=s=>{s.type==="video"?(C.endedCallback=async()=>{const t=await h.completeLecture(g,s.id,!0);s.is_completed=t.is_completed},C.showPlayer(s.link)):window.open(s.link,"_blank")},z=async()=>{if(m.value)try{await h.completeLecture(g,m.value.id,!0),m.value.is_completed=!0,y.value=!1}catch(s){console.error("Error confirming lecture completion:",s)}},A=s=>{m.value=s,y.value=!0},L=b(()=>n.value?n.value.modules.reduce((s,t)=>s+t.lectures.length,0):0),B=b(()=>n.value?n.value.modules.reduce((s,t)=>s+t.lectures.filter(d=>d.is_completed).length,0):0),S=b(()=>L.value?B.value/L.value*100:0);return(s,t)=>{var d;return l(),c("div",J,[k.value?(l(),c("div",K,i(k.value),1)):n.value?(l(),c("div",Q,[e("div",T,[e("div",null,[e("h1",W,i(n.value.title),1),X]),e("div",null,[e("div",Z,[e("div",ee,[se,e("div",te,[e("span",oe,i(Math.round(S.value))+"% ",1)])]),e("div",le,[e("div",{style:O({width:S.value+"%"}),class:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-sky-600"},null,4)])])]),ce,e("ul",re,[(l(!0),c($,null,P(n.value.modules,r=>(l(),c("li",{class:"card-bg p-4",key:r.id},[e("div",{onClick:o=>j(r.id),class:"flex flex-1 items-center gap-4 cursor-pointer"},[e("div",ie,[e("div",{class:x(["text-xl font-bold text-orange-500",{"!text-gray-400":r.is_active==0}])},i(r.order),3),ae]),e("div",de,[e("h4",{class:x(["title-md",{"text-gray-400":r.is_active==0}])},i(r.title),3),e("p",ue,i(r.description),1)]),e("button",null,[e("i",{class:x(v.value.includes(r.id)?"fas fa-angle-up":"fas fa-angle-down")},null,2)])],8,ne),v.value.includes(r.id)?(l(),c("div",pe,[e("ul",_e,[(l(!0),c($,null,P(r.lectures,o=>(l(),c("li",{class:"pt-2",key:o.id},[e("a",{onClick:Y(N=>E(o),["prevent"]),class:"flex items-center gap-4 bg-gray-100 hover:bg-sky-100 p-2 rounded-md cursor-pointer"},[e("div",ve,[e("i",{class:x(o.type==="virtual_platform"?"fas fa-video":"fas fa-play-circle")},null,2),e("div",me,[o.type==="virtual_platform"?(l(),c("p",fe,"Video")):(l(),c("p",ye,"Lecture"))])]),e("div",xe,[e("h4",null,i(o.title),1),e("p",ge,i(o.description),1)])],8,he),e("div",ke,[e("input",{type:"checkbox",id:`completed-${o.id}`,class:"form-checkbox h-3 w-3 text-sky-600 transition duration-150 ease-in-out",checked:o.is_completed,onChange:N=>A(o),disabled:o.is_completed},null,40,be),e("label",{for:`completed-${o.id}`,class:"ml-2"}," Have you completed this lecture? ",8,we)])]))),128))])])):I("",!0)]))),128))])])])):(l(),c("div",Ce,"Loading...")),y.value?(l(),c("div",Le,[Se,e("div",Me,[$e,e("div",Pe,[e("p",Ie,' Are you sure you have completed the lecture "'+i((d=m.value)==null?void 0:d.title)+'"? ',1)]),e("div",je,[e("button",{onClick:z,type:"button",class:"btn-2"},"Yes"),e("button",{onClick:t[0]||(t[0]=r=>y.value=!1),type:"button",class:"btn-3"},"No")])])])):I("",!0)])}}};export{ze as default};
