import{a as k}from"./vendor-PJuFQbji.js";import{d as L,r as x,Q as v,x as n,y as s,z as e,C as f,X as p,A as g,B as h,F as w,G as b,I as C,O as I}from"./vue-CAqJJQzZ.js";import{k as S}from"./index--DNSAfWm.js";const _=L("software-charge",()=>{const r=x(null),i=x([]),o=x([]),l=x(!1);return{error:r,isLoaded:l,payments:i,monthWiseTotalIncome:o,fetchMonthWiseTotalIncome:async()=>{var t,a;try{const{data:d}=await S.get("/month-wise-total-income");o.value=d}catch(d){throw r.value=((a=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:a.message)??"An error occurred",r.value}},fetchPaidHistory:async()=>{var a,d;const t="https://ihsanit.com";try{const{data:c}=await k.get(`${t}/api/software-charges/paid/history`,{headers:{"Content-Type":"application/json"}});return l.value=!0,i.value=c,c}catch(c){throw r.value=((d=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:d.message)??"An error occurred",r.value}},paymentSoftwareCharge:async(t,a)=>{const c=`https://ihsanit.com/software-charges/payment/${t}/${a}`;return console.log(c),window.location=c}}}),T={class:"hover:bg-sky-700/15 *:px-1 *:py-1 *:border *:md:px-4 *:md:py-2"},$={class:"w-full flex gap-1 justify-between"},P={class:"w-full flex gap-1 justify-between"},j={key:0,class:"text-center animate-pulse"},A={key:1,class:"w-full flex gap-1 justify-between"},B={key:0,class:"text-center animate-pulse"},M={key:1,class:"w-full flex gap-1 justify-between"},D={key:2,class:"px-1.5 md:px-2.5 py-px rounded-xl border border-green-400 bg-green-100 text-green-600 font-mono text-xs md:text-sm"},F={key:0,class:"text-center animate-pulse"},R={key:1,class:"flex justify-center items-center gap-4"},U={key:1,class:"leading-tight"},W={key:2,class:"flex justify-center items-center gap-2 text-xs md:text-sm font-mono"},N={class:"inline-flex items-center gap-1 pt-px"},H={__name:"MonthlyTableRow",props:["monthIncome","percentage"],setup(r){const i=r,o=_(),l=v(()=>(i.monthIncome.total_income*i.percentage*.01).toFixed(0)),m=v(()=>{var t;return((t=o.payments)==null?void 0:t.filter(a=>a.month===i.monthIncome.month)).reduce((a,d)=>a+Number(d.paid_amount),0).toFixed(0)}),y=v(()=>{var u;return(u=o.payments)==null?void 0:u.filter(t=>t.month===i.monthIncome.month).map(t=>t.trx_id)});return(u,t)=>(s(),n("tr",T,[e("td",null,f(new Date(r.monthIncome.month+"-01").toLocaleString("default",{month:"short",year:"numeric"}).toUpperCase()),1),e("td",null,[e("div",$,[t[1]||(t[1]=e("span",null,"৳",-1)),p(" "+f(r.monthIncome.total_income),1)])]),e("td",null,[e("div",P,[t[2]||(t[2]=e("span",null,"৳",-1)),p(" "+f(l.value),1)])]),e("td",null,[h(o).isLoaded?g("",!0):(s(),n("div",j,"Loading...")),h(o).isLoaded&&m.value>0?(s(),n("div",A,[t[3]||(t[3]=e("span",null,"৳",-1)),p(" "+f(m.value),1)])):g("",!0)]),e("td",null,[h(o).isLoaded?l.value-m.value>0?(s(),n("div",M,[t[4]||(t[4]=e("span",null,"৳",-1)),p(" "+f((l.value-m.value).toFixed(0)),1)])):l.value>0?(s(),n("span",D," Paid ")):g("",!0):(s(),n("div",B,"Loading..."))]),e("td",null,[h(o).isLoaded?g("",!0):(s(),n("div",F,"Loading...")),h(o).isLoaded&&l.value-m.value>0?(s(),n("div",R,[r.monthIncome.month!==new Date().toISOString().slice(0,7)?(s(),n("button",{key:0,onClick:t[0]||(t[0]=a=>h(o).paymentSoftwareCharge(r.monthIncome.month,l.value-m.value)),class:"btn-2 px-2.5 pt-1 pb-0.5 text-xs md:text-sm"}," Pay Charge ")):(s(),n("div",U,t[5]||(t[5]=[e("div",null,"Processing...",-1),e("div",{class:"text-xs text-sky-700"},"Bill arrives month-end.",-1)])))])):h(o).isLoaded&&l.value>0?(s(),n("div",W,[e("span",N,[t[6]||(t[6]=e("span",{class:"text-gray-400"},"TrxID:",-1)),(s(!0),n(w,null,b(y.value,a=>(s(),n("span",{key:a},f(a),1))),128))])])):g("",!0)])]))}},V={class:"my-container space-y-4"},O={key:0,class:"text-center mt-2"},z={key:1,class:"text-red-500 text-center mb-4"},E={key:2,class:"overflow-x-auto"},G={class:"w-full table table-auto text-center text-xs md:text-base"},J={__name:"SoftwareCharge",setup(r){const i=_(),o=x(null),l=x(!1);return C(async()=>{await i.fetchMonthWiseTotalIncome(),await i.fetchPaidHistory()}),(m,y)=>(s(),n("div",V,[y[1]||(y[1]=e("h1",{class:"text-3xl font-bold mb-6 text-center"},"Software Charge",-1)),l.value?(s(),n("div",O,"Loading...")):o.value?(s(),n("div",z,f(o.value),1)):(s(),n("div",E,[e("table",G,[y[0]||(y[0]=e("thead",null,[e("tr",{class:"bg-gray-200 *:px-2 *:py-1.5"},[e("th",{class:"border"},"Month"),e("th",{class:"border"},[p("Total "),e("span",{class:"hidden md:inline"},"Transaction")]),e("th",{class:"border"},[e("span",{class:"hidden md:inline"},"Software"),p(" Charge")]),e("th",{class:"border"},[p("Paid "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},[p("Due "),e("span",{class:"hidden md:inline"},"Amount")]),e("th",{class:"border"},"Action")])],-1)),e("tbody",null,[(s(!0),n(w,null,b(h(i).monthWiseTotalIncome,u=>(s(),I(H,{key:u.month,monthIncome:u,percentage:5},null,8,["monthIncome"]))),128))])])]))]))}};export{J as default};
